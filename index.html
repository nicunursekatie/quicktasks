<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Dashboard</title>
    <!-- Google API Script -->
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Google Maps API - Load with callback -->
    <script>
        // Google Maps API will be loaded dynamically when needed
        window.googleMapsLoaded = false;
        window.googleMapsAutocomplete = null;
        window.googleMapsMap = null;
        window.googleMapsMarker = null;
        
        window.loadGoogleMapsAPI = function() {
            if (window.googleMapsLoaded) return Promise.resolve();
            
            return new Promise((resolve, reject) => {
                // Get API key from settings (will be available after app.js loads)
                const apiKey = (typeof settings !== 'undefined' && settings?.googleMapsApiKey) || '';
                if (!apiKey) {
                    reject(new Error('Google Maps API key not configured. Please add it in Settings.'));
                    return;
                }
                
                // Check if script already exists
                if (document.querySelector('script[src*="maps.googleapis.com"]')) {
                    window.googleMapsLoaded = true;
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&libraries=places&callback=initGoogleMaps`;
                script.async = true;
                script.defer = true;
                
                window.initGoogleMaps = function() {
                    window.googleMapsLoaded = true;
                    resolve();
                };
                
                script.onerror = () => {
                    reject(new Error('Failed to load Google Maps API. Check your API key and enabled APIs.'));
                };
                
                document.head.appendChild(script);
            });
        }
    </script>
    <style>
        /* ============================================
           QUICKTASKS PREMIUM REDESIGN
           A clean, minimal, and sophisticated UI
           ============================================ */

        /* Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Premium Neutral Palette */
            --bg-page: #FAFAFA;
            --bg-card: #FFFFFF;
            --bg-card-hover: #FEFEFE;
            --bg-input: #FFFFFF;
            --bg-overlay: rgba(15, 23, 42, 0.6);
            --bg-elevated: #FFFFFF;
            --bg-subtle: #F8FAFC;
            --bg-hover: #F1F5F9;

            /* Refined Borders */
            --border-light: #E2E8F0;
            --border-medium: #CBD5E1;
            --border-strong: #94A3B8;

            /* Premium Accent - Refined Amber/Gold */
            --accent-primary: #F59E0B;
            --accent-primary-hover: #D97706;
            --accent-bright: #FBBF24;
            --accent-light: #FEF3C7;
            --accent-subtle: #FFFBEB;

            /* Typography - Better Contrast */
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-muted: #94A3B8;
            --text-inverse: #FFFFFF;
            --text-disabled: #CBD5E1;

            /* Semantic Colors */
            --status-success: #10B981;
            --status-success-light: #D1FAE5;
            --status-warning: #F59E0B;
            --status-warning-light: #FEF3C7;
            --status-error: #EF4444;
            --status-error-light: #FEE2E2;
            --status-info: #3B82F6;
            --status-info-light: #DBEAFE;

            /* Zone Colors - Sophisticated Palette */
            --zone-critical: #EF4444;
            --zone-critical-bg: #FEF2F2;
            --zone-today: #3B82F6;
            --zone-today-bg: #EFF6FF;
            --zone-tomorrow: #6366F1;
            --zone-tomorrow-bg: #EEF2FF;
            --zone-week: #8B5CF6;
            --zone-week-bg: #F5F3FF;
            --zone-focus: #F59E0B;
            --zone-focus-bg: #FFFBEB;
            --zone-inbox: #64748B;
            --zone-inbox-bg: #F8FAFC;
            --zone-nice: #06B6D4;
            --zone-nice-bg: #ECFEFF;

            /* Premium Shadows */
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06), 0 1px 2px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.03);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 0 3px rgba(245, 158, 11, 0.12);
            --shadow-glow-primary: 0 0 20px rgba(245, 158, 11, 0.15);

            /* Spacing System */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-2xl: 48px;
            --spacing-3xl: 64px;

            /* Border Radius */
            --radius-xs: 4px;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-full: 9999px;

            /* Transitions */
            --transition-fast: 0.1s ease;
            --transition-base: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);

            /* Layout */
            --sidebar-width: 300px;
            --header-height: 56px;
            --focus-banner-height: 56px;
        }

        /* Keyframe Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        @keyframes focusPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
            50% { box-shadow: 0 0 40px rgba(245, 158, 11, 0.5); }
        }

        /* Base Typography */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-page);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
            color: var(--text-primary);
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            letter-spacing: -0.01em;
        }

        /* ============================================
           TOP NAVIGATION BAR - Premium Minimal Design
           ============================================ */

        .top-bar {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-light);
            padding: 0 var(--spacing-lg);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--spacing-md);
            position: relative;
            z-index: 100;
        }

        .quick-links {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: nowrap;
            overflow-x: auto;
            flex: 1;
            scrollbar-width: thin;
            -ms-overflow-style: auto;
            padding: var(--spacing-sm) 0;
        }

        .quick-links::-webkit-scrollbar {
            height: 6px;
        }

        .quick-links::-webkit-scrollbar-track {
            background: transparent;
        }

        .quick-links::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.1);
            border-radius: 999px;
        }

        .quick-link {
            background: transparent;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: var(--radius-md);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all var(--transition-base);
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .quick-link:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .quick-link:active {
            background: var(--border-light);
        }

        .controls {
            display: flex;
            gap: var(--spacing-xs);
            align-items: center;
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
            background: var(--bg-card);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            font-size: 16px;
        }

        .icon-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-medium);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .icon-btn:active {
            transform: translateY(0) scale(0.98);
            background: var(--border-light);
        }

        .icon-btn.icon-btn--gradient,
        .icon-btn[style*="background: linear-gradient"] {
            border: none;
            color: white;
        }

        /* Sync Status - Clean Indicator */
        .sync-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: var(--radius-md);
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-subtle);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            transition: all var(--transition-base);
        }

        .sync-status .sync-icon {
            font-size: 8px;
        }

        .sync-status.syncing {
            background: var(--status-info-light);
            border-color: var(--status-info);
            color: var(--status-info);
        }

        .sync-status.syncing .sync-icon {
            animation: spin 1s linear infinite;
        }

        .sync-status.synced {
            background: var(--status-success-light);
            border-color: var(--status-success);
            color: var(--status-success);
        }

        .sync-status.error {
            background: var(--status-error-light);
            border-color: var(--status-error);
            color: var(--status-error);
        }

        .sync-status.offline {
            background: var(--bg-subtle);
            border-color: var(--border-medium);
            color: var(--text-muted);
        }

        .sync-status.offline .sync-icon {
            animation: offline-pulse 1.5s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes offline-pulse {
            0% {
                opacity: 0.7;
            }
            50% {
                opacity: 0.3;
            }
            100% {
                opacity: 0.7;
            }
        }

        /* ============================================
           FOCUS MODE BANNER - Premium Alert
           ============================================ */

        .focus-banner {
            background: linear-gradient(135deg, var(--accent-light) 0%, #FEF9EE 100%);
            border-bottom: 1px solid var(--accent-primary);
            padding: 12px 24px;
            position: relative;
            z-index: 100;
            animation: slideDown 0.3s ease-out;
        }

        .focus-banner.hidden {
            display: none;
        }

        .focus-banner-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .focus-banner-icon {
            font-size: 24px;
            animation: bounce 2s ease-in-out infinite;
        }

        .focus-banner-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-primary-hover);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .focus-banner-task {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
            text-align: center;
        }

        .focus-banner-stop {
            background: var(--status-error);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .focus-banner-stop:hover {
            background: #DC2626;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* ============================================
           MAIN LAYOUT - Clean Grid System
           ============================================ */

        .main-container {
            display: flex;
            height: calc(100vh - var(--header-height));
            transition: height var(--transition-slow);
        }

        .main-container.with-focus-banner {
            height: calc(100vh - var(--header-height) - var(--focus-banner-height));
        }

        /* Central Task Area */
        .tasks-center {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-xl);
            background: var(--bg-page);
        }

        .tasks-center::-webkit-scrollbar {
            width: 6px;
        }

        .tasks-center::-webkit-scrollbar-track {
            background: transparent;
        }

        .tasks-center::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: var(--radius-full);
        }

        .tasks-center::-webkit-scrollbar-thumb:hover {
            background: var(--border-strong);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Left Sidebar - Clean Design */
        .left-sidebar {
            width: var(--sidebar-width);
            background: var(--bg-card);
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            order: -1;
            height: 100%;
        }

        .left-sidebar::-webkit-scrollbar {
            width: 4px;
        }

        .left-sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .left-sidebar::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: var(--radius-full);
        }

        /* ============================================
           SIDEBAR SECTIONS - Clean & Organized
           ============================================ */

        .resources-section {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
        }

        .resources-header {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .embedded-section {
            display: flex;
            flex-direction: column;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
        }

        .embedded-header {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: var(--spacing-sm);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .resource-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .resource-link {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 10px 12px;
            background: transparent;
            border-radius: var(--radius-md);
            text-decoration: none;
            transition: all var(--transition-base);
            border: 1px solid transparent;
        }

        .resource-link:hover {
            background: var(--bg-hover);
        }

        .resource-link:active {
            background: var(--border-light);
        }

        .resource-title {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
            transition: color var(--transition-base);
        }

        .resource-link:hover .resource-title {
            color: var(--text-primary);
        }

        .quick-links-section {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* ============================================
           CALENDAR WIDGET - Minimal Design
           ============================================ */

        .calendar-widget {
            background: var(--bg-subtle);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-light);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .calendar-month {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calendar-nav {
            display: flex;
            gap: 4px;
        }

        .calendar-nav-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            transition: all var(--transition-base);
        }

        .calendar-nav-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-medium);
            color: var(--text-primary);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 4px;
        }

        .calendar-day-name {
            text-align: center;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            padding: 4px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-date {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .calendar-date:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .calendar-date.today {
            background: var(--accent-primary);
            color: white;
            font-weight: 700;
        }

        .calendar-date.other-month {
            color: var(--text-disabled);
        }

        .calendar-date.selected {
            background: var(--status-info);
            color: white;
        }

        .expand-calendar-btn {
            background: transparent;
            border: 1px solid var(--border-light);
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            font-size: 12px;
            transition: all var(--transition-base);
        }

        .expand-calendar-btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-medium);
            color: var(--text-primary);
        }

        /* Full Calendar Modal */
        .full-calendar-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(68, 64, 60, 0.5);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .full-calendar-modal.active {
            display: flex;
        }

        .full-calendar-content {
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            width: 95%;
            max-width: 1000px;
            max-height: 90vh;
            overflow: hidden;
            animation: slideUp 0.2s ease-out;
        }

        .full-calendar-header {
            background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
            color: #78350F;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .full-calendar-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            color: #78350F;
            text-shadow: none;
        }

        .full-calendar-close {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: #78350F;
            font-size: 24px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .full-calendar-close:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .full-calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-light);
        }

        .full-calendar-nav-btn {
            background: var(--accent-light);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .full-calendar-nav-btn:hover {
            background: var(--accent-primary);
            color: white;
        }

        .full-calendar-month-year {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .full-calendar-body {
            padding: 20px 24px;
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .full-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .full-calendar-day-name {
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 12px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .full-calendar-day {
            min-height: 80px;
            padding: 8px;
            background: var(--bg-page);
            border-radius: 10px;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .full-calendar-day:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2);
        }

        .full-calendar-day.today {
            background: var(--accent-light);
            border-color: var(--accent-primary);
        }

        .full-calendar-day.other-month {
            opacity: 0.4;
        }

        .full-calendar-day-number {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .full-calendar-day.today .full-calendar-day-number {
            background: var(--accent-primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .full-calendar-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .full-calendar-event {
            font-size: 10px;
            padding: 2px 6px;
            background: var(--accent-primary);
            color: white;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .full-calendar-event.google {
            background: #4285F4;
        }

        .full-calendar-event.task {
            background: var(--accent-primary);
        }

        .google-connect-section {
            padding: 16px 24px;
            border-top: 1px solid var(--border-light);
            background: var(--bg-page);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .google-connect-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: white;
            border: 2px solid #4285F4;
            border-radius: 8px;
            color: #4285F4;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .google-connect-btn:hover {
            background: #4285F4;
            color: white;
        }

        .google-connect-btn img {
            width: 18px;
            height: 18px;
        }

        .google-status {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .google-status.connected {
            color: #16a34a;
        }

        /* Let's Get To Work View */
        .work-session-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            z-index: 20000;
            overflow-y: auto;
        }

        .work-session-overlay.active {
            display: block;
        }

        .work-session-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .work-session-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .work-session-title {
            font-size: 42px;
            font-weight: 800;
            color: #FBBF24;
            margin: 0 0 8px;
            text-shadow: 0 4px 20px rgba(251, 191, 36, 0.3);
        }

        .work-session-subtitle {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.7);
            margin: 0;
        }

        .work-session-timer {
            font-size: 48px;
            font-weight: 700;
            color: white;
            text-align: center;
            margin: 20px 0;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .work-session-progress {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .work-session-progress-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
        }

        .work-session-progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .work-session-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #F59E0B, #FBBF24);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .work-session-tasks {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 30px;
        }

        .work-task-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .work-task-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .work-task-card.completed {
            opacity: 0.5;
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .work-task-card.current {
            border-color: #FBBF24;
            box-shadow: 0 0 30px rgba(251, 191, 36, 0.2);
            background: rgba(251, 191, 36, 0.1);
        }

        .work-task-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 12px;
        }

        .work-task-checkbox {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.4);
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
            font-size: 16px;
            color: transparent;
        }

        .work-task-checkbox:hover {
            border-color: #FBBF24;
            background: rgba(251, 191, 36, 0.1);
        }

        .work-task-card.completed .work-task-checkbox {
            border-color: #22C55E;
            background: #22C55E;
            color: white;
        }

        .work-task-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
            flex: 1;
        }

        .work-task-card.completed .work-task-title {
            text-decoration: line-through;
            opacity: 0.7;
        }

        .work-task-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-left: 44px;
        }

        .work-task-links {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .work-task-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(66, 133, 244, 0.2);
            border: 1px solid rgba(66, 133, 244, 0.4);
            border-radius: 8px;
            color: #93C5FD;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .work-task-link:hover {
            background: rgba(66, 133, 244, 0.3);
            border-color: #93C5FD;
        }

        .work-task-phone {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.4);
            border-radius: 8px;
            color: #86EFAC;
            font-size: 13px;
            font-weight: 500;
        }

        .work-task-phone a {
            color: #86EFAC;
            text-decoration: none;
        }

        .work-task-phone a:hover {
            text-decoration: underline;
        }

        .work-task-notes {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            line-height: 1.5;
        }

        .work-session-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 30px;
        }

        .work-session-btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .work-session-btn.primary {
            background: linear-gradient(135deg, #F59E0B, #FBBF24);
            color: #78350F;
        }

        .work-session-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        .work-session-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .work-session-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .work-session-btn.danger {
            background: rgba(239, 68, 68, 0.2);
            color: #FCA5A5;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .work-session-btn.danger:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* Add Task to Work Session */
        .work-add-task-section {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .work-add-task-title {
            font-size: 16px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 16px;
        }

        .work-add-task-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .work-add-task-row {
            display: flex;
            gap: 12px;
        }

        .work-add-input {
            flex: 1;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-family: inherit;
        }

        .work-add-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .work-add-input:focus {
            outline: none;
            border-color: #FBBF24;
            background: rgba(255, 255, 255, 0.15);
        }

        .work-add-btn {
            padding: 12px 20px;
            background: #FBBF24;
            border: none;
            border-radius: 10px;
            color: #78350F;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .work-add-btn:hover {
            background: #F59E0B;
        }

        /* Motivational message */
        .work-motivation {
            text-align: center;
            padding: 20px;
            margin-top: 20px;
        }

        .work-motivation-text {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
        }

        /* Start Work Session Button */
        .start-work-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--accent-primary);
            border: none;
            border-radius: var(--radius-md);
            color: white;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .start-work-btn:hover {
            background: var(--accent-primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* In-frame Calendar View */
        .calendar-frame-view {
            display: none;
            padding: 24px;
            height: 100%;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .calendar-frame-view.active {
            display: flex;
            flex-direction: column;
        }

        .tasks-content {
            display: block;
        }

        .tasks-content.hidden {
            display: none;
        }

        .calendar-frame-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .calendar-frame-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-medium);
            border-radius: 10px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-back-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .calendar-frame-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 24px;
        }

        .calendar-frame-nav-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .calendar-frame-nav-btn:hover {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .calendar-frame-month {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            min-width: 200px;
            text-align: center;
        }

        .calendar-frame-grid {
            display: none;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 16px;
            box-shadow: var(--shadow-md);
            flex: 1;
            min-height: 0;
        }

        .calendar-frame-grid.active {
            display: grid;
        }

        .calendar-frame-day-name {
            text-align: center;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            padding: 12px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calendar-frame-day {
            min-height: 80px;
            padding: 8px;
            background: var(--bg-page);
            border-radius: 10px;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
            overflow: hidden;
        }

        .calendar-frame-day:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
        }

        .calendar-frame-day.today {
            background: var(--accent-light);
            border-color: var(--accent-primary);
            border-width: 2px;
        }

        .calendar-frame-day.other-month {
            opacity: 0.4;
        }

        .calendar-frame-day-number {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .calendar-frame-day.today .calendar-frame-day-number {
            background: var(--accent-primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-frame-events {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .calendar-frame-event {
            font-size: 11px;
            padding: 3px 8px;
            background: var(--accent-primary);
            color: white;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }

        .calendar-frame-event.google {
            background: #4285F4;
        }

        .calendar-frame-more {
            font-size: 11px;
            color: var(--text-muted);
            padding: 2px 0;
        }

        /* Calendar View Toggle Buttons */
        .calendar-view-toggle {
            display: flex;
            gap: 4px;
            background: var(--bg-page);
            padding: 4px;
            border-radius: 10px;
            margin-left: 20px;
        }

        .calendar-view-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-view-btn:hover {
            color: var(--text-primary);
            background: var(--bg-card);
        }

        .calendar-view-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        /* Week View Styles */
        .calendar-week-view {
            display: none;
            flex-direction: column;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            flex: 1;
            min-height: 0;
        }

        .calendar-week-view.active {
            display: flex;
        }

        .calendar-week-header {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            border-bottom: 2px solid var(--border-light);
            padding-bottom: 12px;
            margin-bottom: 0;
        }

        .calendar-week-header-cell {
            text-align: center;
            padding: 8px 4px;
        }

        .calendar-week-day-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .calendar-week-day-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 4px;
        }

        .calendar-week-header-cell.today .calendar-week-day-number {
            background: var(--accent-primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-week-body {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .calendar-week-time-column {
            border-right: 1px solid var(--border-light);
        }

        .calendar-week-time-slot {
            height: 60px;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            text-align: right;
            border-bottom: 1px solid var(--border-light);
        }

        .calendar-week-day-column {
            border-right: 1px solid var(--border-light);
            position: relative;
        }

        .calendar-week-day-column:last-child {
            border-right: none;
        }

        .calendar-week-hour-slot {
            height: 60px;
            border-bottom: 1px solid var(--border-light);
            position: relative;
        }

        .calendar-week-event {
            position: absolute;
            left: 2px;
            right: 2px;
            background: #4285F4;
            color: white;
            font-size: 11px;
            padding: 4px 6px;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            z-index: 1;
        }

        .calendar-week-event:hover {
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .calendar-week-event-title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-week-event-time {
            font-size: 10px;
            opacity: 0.9;
        }

        .calendar-week-all-day-row {
            display: grid;
            grid-template-columns: 60px repeat(7, 1fr);
            border-bottom: 2px solid var(--border-light);
            min-height: 40px;
        }

        .calendar-week-all-day-label {
            font-size: 10px;
            color: var(--text-muted);
            padding: 8px 4px;
            text-align: right;
            border-right: 1px solid var(--border-light);
        }

        .calendar-week-all-day-cell {
            padding: 4px;
            border-right: 1px solid var(--border-light);
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }

        .calendar-week-all-day-cell:last-child {
            border-right: none;
        }

        .calendar-week-all-day-event {
            background: #4285F4;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        /* Day View Styles */
        .calendar-day-view {
            display: none;
            flex-direction: column;
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            flex: 1;
            min-height: 0;
        }

        .calendar-day-view.active {
            display: flex;
        }

        .calendar-day-header {
            text-align: center;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-light);
            margin-bottom: 0;
        }

        .calendar-day-header-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calendar-day-header-number {
            font-size: 48px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .calendar-day-header.today .calendar-day-header-number {
            color: var(--accent-primary);
        }

        .calendar-day-all-day-section {
            padding: 12px 0;
            border-bottom: 2px solid var(--border-light);
            min-height: 50px;
        }

        .calendar-day-all-day-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .calendar-day-all-day-events {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .calendar-day-all-day-event {
            background: #4285F4;
            color: white;
            font-size: 12px;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
        }

        .calendar-day-schedule {
            display: grid;
            grid-template-columns: 70px 1fr;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .calendar-day-time-column {
            border-right: 1px solid var(--border-light);
        }

        .calendar-day-time-slot {
            height: 60px;
            padding: 4px 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            text-align: right;
            border-bottom: 1px solid var(--border-light);
        }

        .calendar-day-events-column {
            position: relative;
        }

        .calendar-day-hour-slot {
            height: 60px;
            border-bottom: 1px solid var(--border-light);
            position: relative;
        }

        .calendar-day-event {
            position: absolute;
            left: 8px;
            right: 8px;
            background: #4285F4;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1;
            box-shadow: 0 2px 6px rgba(66, 133, 244, 0.3);
        }

        .calendar-day-event:hover {
            z-index: 2;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.4);
        }

        .calendar-day-event-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .calendar-day-event-time {
            font-size: 12px;
            opacity: 0.9;
        }

        .calendar-day-event-location {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 4px;
        }

        .calendar-frame-footer {
            margin-top: 24px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .calendar-google-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-google-status {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .calendar-google-status.connected {
            color: #16a34a;
        }

        /* Calendar Picker */
        .calendar-picker-section {
            margin-top: 16px;
            padding: 16px;
            background: var(--bg-page);
            border-radius: 10px;
            border: 1px solid var(--border-light);
        }

        .calendar-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .calendar-picker-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .calendar-picker-toggle {
            font-size: 12px;
            color: var(--accent-primary);
            background: none;
            border: none;
            cursor: pointer;
        }

        .calendar-picker-toggle:hover {
            text-decoration: underline;
        }

        .calendar-picker-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .calendar-picker-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-picker-item:hover {
            border-color: var(--accent-primary);
        }

        .calendar-picker-item.disabled {
            opacity: 0.5;
        }

        .calendar-picker-checkbox {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid var(--border-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .calendar-picker-item.selected .calendar-picker-checkbox {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .calendar-picker-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .calendar-picker-name {
            font-size: 13px;
            color: var(--text-primary);
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .calendar-picker-count {
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-page);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* ============================================
           NOTES SECTION - Sidebar Notes
           ============================================ */

        .notes-section {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
            min-height: 280px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex: 1;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .add-note-btn {
            width: 24px;
            height: 24px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-light);
            background: var(--bg-card);
            color: var(--text-muted);
            font-size: 16px;
            font-weight: 400;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
        }

        .add-note-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .notes-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .note-item {
            background: var(--bg-subtle);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            position: relative;
            transition: all var(--transition-base);
        }

        .note-item:hover {
            background: var(--bg-hover);
            border-color: var(--border-light);
        }

        .note-item.editing {
            border-color: var(--accent-primary);
            box-shadow: var(--shadow-glow);
            background: var(--bg-card);
        }

        .note-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-word;
            cursor: text;
            min-height: 18px;
        }

        .note-content:empty::before {
            content: 'Click to add note...';
            color: var(--text-muted);
            font-style: italic;
        }

        .note-textarea {
            width: 100%;
            border: none;
            background: transparent;
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.5;
            resize: none;
            font-family: inherit;
            outline: none;
            min-height: 60px;
        }

        .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 6px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .note-item:hover .note-actions,
        .note-item.editing .note-actions {
            opacity: 1;
        }

        .note-action-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .note-action-btn:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .note-action-btn.delete:hover {
            background: #FEF2F2;
            color: var(--status-error);
        }

        .note-timestamp {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 6px;
        }

        .notes-empty {
            text-align: center;
            color: var(--text-muted);
            font-size: 13px;
            padding: 20px;
            font-style: italic;
        }

        /* Note Tags */
        .notes-tag-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 10px;
        }

        .notes-tag-filter:empty {
            display: none;
        }

        .tag-filter-btn {
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid var(--border-light);
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tag-filter-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        .tag-filter-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .tag-filter-btn.all-notes {
            background: var(--bg-hover);
        }

        .note-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 6px;
        }

        .note-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--accent-light);
            color: var(--accent-primary);
            font-size: 10px;
            font-weight: 600;
        }

        .note-tag-remove {
            cursor: pointer;
            opacity: 0.7;
            font-size: 12px;
            line-height: 1;
        }

        .note-tag-remove:hover {
            opacity: 1;
        }

        .note-tag-input-wrapper {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border-light);
        }

        .note-tag-input {
            flex: 1;
            min-width: 80px;
            padding: 4px 8px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            font-size: 11px;
            background: var(--bg-page);
            color: var(--text-primary);
            outline: none;
        }

        .note-tag-input:focus {
            border-color: var(--accent-primary);
        }

        .note-tag-input::placeholder {
            color: var(--text-muted);
        }

        .existing-tag-btn {
            padding: 2px 8px;
            border-radius: 10px;
            border: 1px dashed var(--border-medium);
            background: transparent;
            color: var(--text-secondary);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .existing-tag-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            border-style: solid;
        }

        .note-action-btn.save-btn {
            background: var(--accent-primary);
            color: white;
            font-weight: 600;
        }

        .note-action-btn.save-btn:hover {
            background: var(--accent-primary-hover);
        }

        .note-action-btn.cancel-btn {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }

        .note-action-btn.cancel-btn:hover {
            background: #FEF2F2;
            color: var(--status-error);
        }

        .date-stamp {
            text-align: left;
            color: var(--text-muted);
            font-size: 13px;
            font-weight: 500;
            margin-bottom: var(--spacing-lg);
            letter-spacing: 0.02em;
        }

        /* ============================================
           BRAIN DUMP INPUT - Quick Task Entry
           ============================================ */

        .brain-dump-container {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-light);
        }

        .brain-dump-input {
            width: 100%;
            min-height: 44px;
            padding: 12px 16px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            background: var(--bg-subtle);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all var(--transition-base);
            resize: none;
        }

        .brain-dump-input::placeholder {
            color: var(--text-muted);
        }

        .brain-dump-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-card);
            box-shadow: var(--shadow-glow);
        }

        .brain-dump-input:hover:not(:focus) {
            border-color: var(--border-medium);
        }

        /* ============================================
           ZONE CARDS - Premium Clean Design
           ============================================ */

        .zone {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: all var(--transition-base);
            position: relative;
        }

        .zone:hover {
            box-shadow: var(--shadow-md);
        }

        /* Zone Color Accents - Subtle Top Border */
        .zone.critical {
            border-top: 3px solid var(--zone-critical);
            background: linear-gradient(180deg, var(--zone-critical-bg) 0%, var(--bg-card) 8%);
        }

        .zone.today {
            border-top: 3px solid var(--zone-today);
            background: linear-gradient(180deg, var(--zone-today-bg) 0%, var(--bg-card) 8%);
        }

        .zone.tomorrow {
            border-top: 3px solid var(--zone-tomorrow);
            background: linear-gradient(180deg, var(--zone-tomorrow-bg) 0%, var(--bg-card) 8%);
        }

        .zone.week {
            border-top: 3px solid var(--zone-week);
            background: linear-gradient(180deg, var(--zone-week-bg) 0%, var(--bg-card) 8%);
        }

        .zone.focus {
            border-top: 3px solid var(--zone-focus);
            background: linear-gradient(180deg, var(--zone-focus-bg) 0%, var(--bg-card) 8%);
        }

        .zone.inbox {
            border-top: 3px solid var(--zone-inbox);
            background: linear-gradient(180deg, var(--zone-inbox-bg) 0%, var(--bg-card) 8%);
        }

        .zone.nice {
            border-top: 3px solid var(--zone-nice);
            background: linear-gradient(180deg, var(--zone-nice-bg) 0%, var(--bg-card) 8%);
        }

        .zone-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }

        .refine-inbox-btn {
            padding: 6px 12px;
            background: var(--zone-inbox);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .refine-inbox-btn:hover {
            background: var(--text-secondary);
            transform: translateY(-1px);
        }

        .zone-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-secondary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }

        .zone-title .zone-icon {
            font-size: 14px;
        }

        .zone-title .zone-count {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            background: var(--bg-subtle);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            margin-left: 4px;
            text-transform: none;
        }

        /* Zone Title Colors */
        .zone.critical .zone-title { color: var(--zone-critical); }
        .zone.today .zone-title { color: var(--zone-today); }
        .zone.tomorrow .zone-title { color: var(--zone-tomorrow); }
        .zone.week .zone-title { color: var(--zone-week); }
        .zone.focus .zone-title { color: var(--zone-focus); }
        .zone.inbox .zone-title { color: var(--zone-inbox); }
        .zone.nice .zone-title { color: var(--zone-nice); }

        .section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-md);
            transition: all 0.2s ease;
            position: relative;
            border: 1px solid var(--border-light);
        }

        .section:hover {
            box-shadow: var(--shadow-lg);
        }

        /* Today Section */
        #todaySection {
            border-left: 5px solid #F59E0B;
        }

        #todaySection h1 {
            color: var(--text-primary);
        }

        /* Longterm Section */
        #longtermSection {
            border-left: 5px solid #D97706;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-light);
        }

        .section-title-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title-group h1 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .badge {
            font-size: 11px;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-today {
            background: #F59E0B;
            color: white;
        }

        .badge-longterm {
            background: #D97706;
            color: white;
        }

        .progress-ring {
            width: 40px;
            height: 40px;
            position: relative;
        }

        .progress-circle {
            transform: rotate(-90deg);
        }

        .progress-circle-bg {
            fill: none;
            stroke: var(--border-light);
            stroke-width: 4;
        }

        .progress-circle-fill {
            fill: none;
            stroke: var(--accent-primary);
            stroke-width: 4;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 11px;
            font-weight: 800;
            color: var(--text-primary);
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            position: relative;
            z-index: 1;
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            letter-spacing: -0.01em;
        }

        .task-group {
            margin-bottom: var(--spacing-lg);
            padding: 0;
            background: transparent;
            border-radius: 0;
            transition: all var(--transition-slow);
            cursor: grab;
        }
        
        .task-group:active {
            cursor: grabbing;
        }
        
        .task-group h2,
        .task-group .group-actions,
        .task-group .group-actions * {
            cursor: default;
        }
        
        .task-group.dragging {
            opacity: 0.5;
            transform: scale(0.98);
            cursor: grabbing;
        }
        
        .task-group.drag-over {
            border-top: 3px solid rgba(79, 172, 254, 0.8);
            padding-top: 10px;
            margin-top: 5px;
        }

        .task-group:last-child {
            margin-bottom: 0;
        }
        
        .drag-handle {
            cursor: grab;
            color: rgba(255, 255, 255, 0.6);
            font-size: 16px;
            user-select: none;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline-block;
            line-height: 1;
        }
        
        .drag-handle:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .drag-handle:active {
            cursor: grabbing;
        }

        .drag-handle-task {
            cursor: grab;
            color: var(--text-muted);
            font-size: 14px;
            user-select: none;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            display: inline-block;
            line-height: 1;
            flex-shrink: 0;
        }

        .drag-handle-task:hover {
            color: var(--text-secondary);
            background: var(--bg-page);
        }

        .drag-handle-task:active {
            cursor: grabbing;
        }

        .task-list {
            min-height: 20px;
            transition: all 0.2s ease;
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-light);
        }

        .group-header h2 {
            margin-bottom: 0;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.02em;
        }

        .group-actions {
            display: flex;
            gap: var(--spacing-xs);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .task-group:hover .group-actions {
            opacity: 1;
        }

        .group-edit-btn, .group-add-task-btn, .group-move-btn, .group-archive-btn, .group-delete-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 28px;
            min-height: 28px;
        }

        .group-edit-btn:hover, .group-add-task-btn:hover, .group-move-btn:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .group-archive-btn:hover {
            background: rgba(245, 158, 11, 0.1);
            color: var(--status-warning);
        }

        .group-delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--status-error);
        }

        .new-project-btn {
            background: var(--accent-primary) !important;
            border: none !important;
            color: white !important;
        }

        .new-project-btn:hover {
            background: var(--accent-primary-hover) !important;
        }

        /* ============================================
           TASK ITEMS - Clean Minimal Design
           ============================================ */

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            padding: 12px 16px;
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-sm);
            transition: all var(--transition-base);
            background: var(--bg-subtle);
            border: 1px solid transparent;
            cursor: grab;
            position: relative;
        }

        .task-item:hover {
            background: var(--bg-hover);
            border-color: var(--border-light);
        }

        /* Remove zone-specific backgrounds for cleaner look */
        .task-item.zone-critical,
        .task-item.zone-focus,
        .task-item.zone-inbox,
        .task-item.zone-nice,
        .task-item.zone-today,
        .task-item.zone-tomorrow,
        .task-item.zone-week {
            background: var(--bg-subtle);
        }

        .task-item.zone-critical:hover,
        .task-item.zone-focus:hover,
        .task-item.zone-inbox:hover,
        .task-item.zone-nice:hover,
        .task-item.zone-today:hover,
        .task-item.zone-tomorrow:hover,
        .task-item.zone-week:hover {
            background: var(--bg-hover);
        }

        .task-item.event-item {
            padding: 12px 16px;
            margin-bottom: var(--spacing-sm);
            background: var(--status-info-light);
            border-left: 3px solid var(--status-info);
            border-radius: var(--radius-lg);
        }

        .zone-events-section {
            margin-bottom: var(--spacing-lg);
        }

        .task-zone-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-left: var(--spacing-sm);
            font-size: 11px;
        }

        .task-blocking-icon {
            color: var(--zone-critical);
            font-size: 12px;
        }

        .task-external-deadline {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            background: var(--status-error-light);
            color: var(--status-error);
            border-radius: var(--radius-sm);
            font-size: 10px;
            font-weight: 600;
            margin-left: var(--spacing-sm);
        }

        .task-focus-indicator {
            color: var(--zone-focus);
            font-size: 12px;
            margin-left: var(--spacing-xs);
        }

        .task-item:active {
            cursor: grabbing;
        }

        .task-item.dragging {
            opacity: 0.6;
            transform: scale(0.98);
            cursor: grabbing;
            box-shadow: var(--shadow-lg);
        }

        .task-item.drag-over {
            border-top: 2px solid var(--accent-primary);
            padding-top: 10px;
        }

        .task-list.drag-over-list {
            background: var(--accent-subtle);
            border-radius: 8px;
            min-height: 50px;
        }

        #todayTasks.drag-over-list,
        #longtermTasks.drag-over-list {
            background: var(--accent-subtle);
            border-radius: 8px;
            border: 2px dashed var(--accent-primary);
            padding: 10px;
            margin: 10px 0;
            min-height: 100px;
        }

        .task-item:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-medium);
        }

        .task-item.checked {
            opacity: 0.5;
        }

        .checkbox-wrapper {
            position: relative;
            flex-shrink: 0;
        }

        .task-item input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-medium);
            border-radius: var(--radius-full);
            cursor: pointer;
            position: relative;
            transition: all var(--transition-base);
            background: var(--bg-card);
            flex-shrink: 0;
            margin-top: 1px;
        }

        .task-item input[type="checkbox"]:hover {
            border-color: var(--status-success);
            background: var(--status-success-light);
        }

        .task-item input[type="checkbox"]:checked {
            background: var(--status-success);
            border-color: var(--status-success);
        }

        .task-item input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: 700;
        }

        .task-content {
            flex: 1;
            min-width: 0;
        }

        .task-title {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .task-item.checked .task-title {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .subtasks {
            margin-top: var(--spacing-sm);
            padding-left: var(--spacing-md);
            border-left: 2px solid var(--border-light);
        }

        .subtask {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-sm);
            padding: 6px 0;
            font-size: 13px;
            color: var(--text-secondary);
            transition: all var(--transition-base);
        }

        .subtask:hover {
            color: var(--text-primary);
        }

        .subtask input[type="checkbox"] {
            appearance: none;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border-medium);
            border-radius: var(--radius-sm);
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
            transition: all var(--transition-base);
            background: var(--bg-card);
            position: relative;
        }

        .subtask input[type="checkbox"]:hover {
            border-color: var(--accent-primary);
        }

        .subtask input[type="checkbox"]:checked {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
        }

        .subtask input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            color: white;
            font-size: 10px;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .subtask.checked {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .task-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            margin-bottom: 4px;
        }

        .task-tag {
            display: inline-block;
            padding: 4px 10px;
            background: var(--accent-light);
            color: var(--accent-primary);
            border: 1px solid var(--accent-primary);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: lowercase;
            transition: all 0.2s ease;
            cursor: default;
        }

        .task-tag:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateY(-1px);
        }

        .quick-add {
            margin-top: 16px;
            display: flex;
            gap: 8px;
        }

        .quick-add input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border-light);
            border-radius: 8px;
            background: var(--bg-input);
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .quick-add input::placeholder {
            color: var(--text-muted);
        }

        .quick-add input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-light);
        }

        .quick-add button {
            padding: 10px 16px;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        .quick-add button:hover {
            background: var(--accent-primary-hover);
        }

        .quick-add button:active {
            transform: scale(0.98);
        }

        /* ============================================
           SIDE PANELS - Stats & Settings
           ============================================ */

        .stats-panel, .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--bg-card);
            box-shadow: var(--shadow-2xl);
            padding: var(--spacing-lg);
            transition: right var(--transition-slow);
            z-index: 1000;
            overflow-y: auto;
            border-left: 1px solid var(--border-light);
        }

        .stats-panel.open, .settings-panel.open {
            right: 0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border-light);
        }

        .panel-header h2 {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 0;
            color: var(--text-primary);
        }

        .close-btn {
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
        }

        .close-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .stat-card {
            background: var(--bg-subtle);
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            margin-bottom: var(--spacing-sm);
            border: 1px solid var(--border-light);
            transition: all var(--transition-base);
        }

        .stat-card:hover {
            border-color: var(--border-medium);
            background: var(--bg-hover);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md) 0;
            border-bottom: 1px solid var(--border-light);
        }

        .setting-label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: var(--border-medium);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .toggle-switch.active {
            background: var(--accent-primary);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: left 0.2s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .toggle-switch.active::after {
            left: 25px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(68, 64, 60, 0.4);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .task-item, .task-group {
            animation: slideIn 0.3s ease;
        }

        /* Mobile Optimizations */
        @media (max-width: 1400px) {
            .left-sidebar {
                width: 300px;
            }
        }

        @media (max-width: 1200px) {
            .tasks-center {
                padding: 16px;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }

            .left-sidebar {
                width: 100%;
                max-height: 40vh;
                border-right: none;
                border-bottom: 1px solid var(--border-light);
                overflow-y: auto;
                order: -1;
            }

            .resources-section {
                max-height: none;
                padding: 12px;
            }

            .embedded-section {
                padding: 12px;
            }

            .tasks-center {
                height: auto;
                max-height: 60vh;
            }
        }

        @media (max-width: 768px) {
            body {
                overflow: auto;
                height: auto;
            }

            .top-bar {
                padding: 10px 12px;
                flex-wrap: wrap;
            }

            .quick-links {
                order: 2;
                width: 100%;
                margin-top: 8px;
                justify-content: flex-start;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .quick-links::-webkit-scrollbar {
                display: none;
            }

            .quick-link {
                font-size: 12px;
                padding: 6px 12px;
            }

            .controls {
                order: 1;
                margin-left: auto;
            }

            .icon-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .main-container {
                height: auto;
                flex-direction: column;
            }

            .tasks-center {
                padding: 12px;
                height: auto;
                max-height: none;
                overflow-y: visible;
            }

            .section {
                padding: 16px;
                margin-bottom: 12px;
                border-radius: 16px;
            }

            .section-header {
                flex-wrap: wrap;
                gap: 10px;
            }

            h1 {
                font-size: 20px;
            }

            h2 {
                font-size: 14px;
            }

            .badge {
                font-size: 9px;
                padding: 4px 10px;
            }

            .progress-ring {
                width: 36px;
                height: 36px;
            }

            .progress-ring svg {
                width: 36px;
                height: 36px;
            }

            .progress-text {
                font-size: 10px;
            }

            /* Make touch targets bigger on mobile */
            .task-item {
                padding: 12px 14px;
                margin-bottom: 8px;
            }

            .task-title {
                font-size: 14px;
            }

            /* Show task actions by default on mobile (no hover) */
            .task-actions {
                opacity: 1;
            }

            .edit-btn, .move-btn, .delete-btn, .ai-btn, .status-toggle-btn {
                padding: 6px 10px;
                font-size: 14px;
            }

            /* Show group actions by default on mobile */
            .group-actions {
                opacity: 1;
            }

            .group-edit-btn, .group-add-task-btn, .group-move-btn, .group-archive-btn, .group-delete-btn {
                padding: 5px 8px;
                font-size: 13px;
            }

            .subtask {
                font-size: 12px;
                padding: 8px 0;
            }

            .subtask-delete-btn {
                opacity: 1;
            }

            .quick-add {
                flex-wrap: wrap;
                gap: 8px;
            }

            .quick-add input {
                width: 100%;
                font-size: 13px;
                padding: 10px 14px;
            }

            .quick-add button {
                flex: 1;
                min-width: calc(50% - 4px);
                font-size: 12px;
                padding: 10px 16px;
            }

            /* Mobile sidebar */
            .left-sidebar {
                width: 100%;
                max-height: none;
                border-right: none;
                border-bottom: 1px solid var(--border-light);
                position: relative;
            }

            .calendar-widget {
                padding: 12px;
            }

            .calendar-month {
                font-size: 14px;
            }

            .calendar-nav-btn {
                padding: 3px 8px;
                font-size: 13px;
            }

            .calendar-date {
                font-size: 11px;
            }

            .resource-link {
                padding: 8px 10px;
            }

            .resource-title {
                font-size: 12px;
            }

            /* Mobile panels */
            .stats-panel, .settings-panel {
                width: 100%;
                right: -100%;
                padding: 20px;
            }

            .panel-header h2 {
                font-size: 20px;
            }

            .stat-card {
                padding: 18px;
            }

            .stat-value {
                font-size: 32px;
            }

            .setting-item {
                padding: 14px 0;
            }

            .date-stamp {
                font-size: 13px;
                margin-bottom: 14px;
            }
        }

        @media (max-width: 480px) {
            .section {
                padding: 14px;
            }

            h1 {
                font-size: 18px;
            }

            h2 {
                font-size: 13px;
            }

            .task-item {
                padding: 10px 12px;
            }

            .quick-add button {
                width: 100%;
                min-width: 100%;
            }

            .stats-panel, .settings-panel {
                padding: 16px;
            }
        }

        /* Small-phone hardening (320/375/390/430) */
        @media (max-width: 430px) {
            html, body {
                max-width: 100%;
                overflow-x: hidden;
            }

            /* Off-canvas panels: avoid negative-right overflow */
            .stats-panel, .settings-panel {
                width: 100vw;
                right: -100vw;
                max-width: 100vw;
                padding: 16px;
            }

            /* Focus banner: allow shrinking + wrapping */
            .focus-banner-content {
                gap: 10px;
            }
            .focus-banner-text {
                font-size: 20px;
                line-height: 1.1;
                text-align: center;
            }
            .focus-banner-task {
                min-width: 0;
                font-size: 22px;
                line-height: 1.15;
                word-break: break-word;
                overflow-wrap: anywhere;
                text-align: center;
            }

            /* Full calendar controls: prevent button row overflow */
            .full-calendar-header {
                padding: 12px 14px;
            }
            .full-calendar-nav {
                padding: 12px 14px;
                gap: 10px;
                flex-wrap: wrap;
            }
            .full-calendar-month-year {
                width: 100%;
                text-align: center;
                font-size: 18px;
            }
            .full-calendar-nav-btn {
                flex: 1;
                min-width: 0;
                padding: 10px 12px;
                font-size: 13px;
            }
            .full-calendar-body {
                padding: 12px 14px;
            }
            .full-calendar-grid {
                gap: 6px;
            }

            /* Calendar frame (sidebar) nav: prevent min-width overflow */
            .calendar-frame-nav {
                flex-wrap: wrap;
                gap: 10px;
                margin-bottom: 16px;
            }
            .calendar-frame-month {
                min-width: 0;
                width: 100%;
                font-size: 18px;
            }
            .calendar-frame-nav-btn {
                flex: 1;
                min-width: 0;
                padding: 10px 12px;
            }
            .calendar-frame-grid {
                padding: 12px;
            }

            /* Event/task modals: make fixed-width inputs fluid */
            #newEventDuration,
            #newEventEndTime,
            #newEventTravelTime,
            #editEventDuration,
            #editEventEndTime,
            #editEventTravelTime {
                width: 100% !important;
                max-width: 100% !important;
            }
        }

        @media (max-width: 375px) {
            .top-bar {
                padding: 10px;
            }
            .icon-btn {
                width: 34px;
                height: 34px;
            }
            .focus-banner-icon {
                font-size: 28px;
            }
        }

        @media (max-width: 320px) {
            .focus-banner-text {
                font-size: 18px;
            }
            .focus-banner-task {
                font-size: 20px;
            }
            .quick-link {
                padding: 6px 10px;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            /* Always show action buttons on touch devices */
            .task-actions {
                opacity: 1 !important;
            }

            .group-actions {
                opacity: 1 !important;
            }

            .subtask-delete-btn {
                opacity: 1 !important;
            }

            /* Larger touch targets */
            .task-item {
                min-height: 50px;
            }

            .edit-btn, .move-btn, .delete-btn, .ai-btn, .status-toggle-btn {
                min-width: 44px;
                min-height: 44px;
            }

            .group-edit-btn, .group-add-task-btn, .group-move-btn, .group-archive-btn, .group-delete-btn {
                min-width: 40px;
                min-height: 40px;
            }

            /* Remove hover effects on touch devices */
            .task-item:hover,
            .section:hover,
            .resource-link:hover,
            .quick-link:hover {
                transform: none;
            }
        }

        /* Landscape mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            .main-container {
                flex-direction: row;
            }

            .left-sidebar {
                width: 300px;
                max-height: 100%;
                border-right: 1px solid var(--border-light);
                border-bottom: none;
            }

            .tasks-center {
                max-height: calc(100vh - 110px);
                overflow-y: auto;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 24px;
            color: var(--text-primary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.8;
            /* Removed float animation to reduce GPU usage */
        }

        .task-actions {
            display: flex;
            gap: 4px;
            align-items: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .task-item:hover .task-actions {
            opacity: 1;
        }

        .edit-btn, .move-btn, .delete-btn, .ai-btn, .focus-btn, .status-toggle-btn, .convert-btn, .zone-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 6px 8px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: all var(--transition-base);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
            min-height: 32px;
        }

        .edit-btn:hover, .move-btn:hover, .ai-btn:hover, .status-toggle-btn:hover, .convert-btn:hover, .zone-btn:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
            transform: translateY(-1px);
        }

        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--status-error);
        }

        .focus-btn.active {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .focus-btn:hover {
            background: var(--accent-light);
            color: var(--accent-primary);
        }

        .zone-btn:hover {
            transform: scale(1.1);
        }

        .task-item.focused-task {
            border: 2px solid var(--accent-primary);
            background: var(--accent-subtle);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .subtask-delete-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            margin-left: 8px;
            opacity: 0;
            transition: all 0.2s ease;
        }

        .subtask:hover .subtask-delete-btn {
            opacity: 1;
        }

        .subtask-delete-btn:hover {
            background: #FEF2F2;
            color: var(--status-error);
        }

        .group-progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 14px;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.2);
        }

        .group-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 15px rgba(67, 233, 123, 0.5);
        }

        /* ============================================
           MODALS - Premium Glass Effect
           ============================================ */

        .custom-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 10000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .custom-modal.active {
            display: flex;
        }

        .custom-modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-2xl);
            border: 1px solid var(--border-light);
            max-width: 480px;
            width: 90%;
            max-height: 85vh;
            overflow: hidden;
            animation: scaleIn 0.2s ease-out;
        }

        .custom-modal-header {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-light);
        }

        .custom-modal-header h3 {
            margin: 0;
            font-size: 17px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .modal-close-btn {
            background: transparent;
            border: none;
            color: var(--text-muted);
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
        }

        .modal-close-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .custom-modal-body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            max-height: calc(85vh - 140px);
        }

        .custom-modal-body p {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 14px;
        }

        #modalInput {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: all var(--transition-base);
            background: var(--bg-subtle);
            color: var(--text-primary);
        }

        #modalInput:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-card);
            box-shadow: var(--shadow-glow);
        }

        .custom-modal-footer {
            padding: var(--spacing-md) var(--spacing-lg);
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
            background: var(--bg-subtle);
            border-top: 1px solid var(--border-light);
        }

        .modal-btn {
            padding: 10px 18px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .modal-btn-cancel {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
        }

        .modal-btn-cancel:hover {
            background: var(--bg-hover);
            border-color: var(--border-medium);
        }

        .modal-btn-submit {
            background: var(--accent-primary);
            color: white;
        }

        .modal-btn-submit:hover {
            background: var(--accent-primary-hover);
        }

        /* Refine Inbox Modal Styles */
        .refine-modal-content {
            max-width: 700px;
            width: 95%;
        }

        .refine-mode-toggle {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--bg-page);
            padding: 4px;
            border-radius: 8px;
        }

        .refine-mode-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 14px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refine-mode-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .refine-task-card {
            background: var(--bg-page);
            border: 2px solid var(--border-light);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .refine-task-card:hover {
            border-color: var(--accent-primary);
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
        }

        .refine-task-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .refine-task-title {
            flex: 1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .refine-quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }

        .refine-quick-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-medium);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refine-quick-btn:hover {
            background: var(--accent-light);
            border-color: var(--accent-primary);
        }

        .refine-quick-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .refine-input-group {
            margin-bottom: 12px;
        }

        .refine-input-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .refine-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            background: var(--bg-input);
            color: var(--text-primary);
        }

        .refine-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px var(--accent-light);
        }

        .refine-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border-light);
        }

        .refine-task-counter {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .refine-nav-buttons {
            display: flex;
            gap: 8px;
        }

        .refine-nav-btn {
            padding: 8px 16px;
            border: 1px solid var(--border-medium);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refine-nav-btn:hover:not(:disabled) {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .refine-nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .refine-task-list {
            max-height: 60vh;
            overflow-y: auto;
        }

        .refine-task-item {
            background: var(--bg-page);
            border: 1px solid var(--border-light);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refine-task-item:hover {
            border-color: var(--accent-primary);
            background: var(--bg-card);
        }

        .refine-task-item-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .refine-batch-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        /* Choice modal buttons */
        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 16px;
        }

        .choice-btn {
            padding: 14px 20px;
            border: 2px solid var(--border-medium);
            border-radius: 10px;
            background: var(--bg-card);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .choice-btn:hover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
            transform: translateY(-1px);
        }

        .choice-btn .choice-icon {
            font-size: 20px;
        }

        .choice-btn .choice-label {
            flex: 1;
            text-align: left;
        }

        .choice-btn .choice-description {
            font-size: 12px;
            font-weight: 400;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Daily Digest Styles */
        .digest-section {
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-page);
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
        }

        .digest-section-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .digest-task-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .digest-task-item {
            padding: 10px 12px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: 6px;
            border: 1px solid var(--border-light);
            transition: all 0.2s ease;
        }

        .digest-task-item:hover {
            border-color: var(--accent-primary);
            transform: translateX(4px);
        }

        .digest-task-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .digest-task-meta {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .digest-task-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .digest-summary {
            padding: 12px;
            background: var(--accent-subtle);
            border-radius: 6px;
            margin-top: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .digest-empty {
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
        }
    </style>
</head>
<body>
    <!-- SVG Gradient Definitions -->
    <svg width="0" height="0" style="position: absolute;">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>

    <div class="overlay" id="overlay"></div>

    <!-- Top Quick Links Bar -->
    <div class="top-bar">
        <div class="quick-links">
            <a href="https://calendar.google.com" target="_blank" class="quick-link">Calendar</a>
            <a href="https://mail.google.com/mail/u/katielong2316@gmail.com" target="_blank" class="quick-link">Personal Gmail</a>
            <a href="https://mail.google.com/mail/u/katie@thesandwichproject.org" target="_blank" class="quick-link">Katie@TSP</a>
            <a href="https://mail.google.com/mail/u/info@thesandwichproject.org" target="_blank" class="quick-link">Info@TSP</a>
            <a href="https://drive.google.com" target="_blank" class="quick-link">Drive</a>
            <a href="https://claude.ai/code" target="_blank" class="quick-link">Claude Code</a>
            <a href="https://sandwich-project-platform-final-katielong2316.replit.app/" target="_blank" class="quick-link">TSP Platform</a>
        </div>
        <div class="controls">
            <button class="start-work-btn" onclick="openWorkSession()" title="Start a focused work session">
                 Let's Work
            </button>
            <div id="syncStatus" class="sync-status offline" title="Cloud sync status">
                <span class="sync-icon">&#9679;</span> Offline
            </div>
            <button class="icon-btn" onclick="showDailyDigest()" title="Daily Digest"></button>
            <button class="icon-btn icon-btn--gradient" onclick="showNewTaskModal()" title="New Task" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 20px;"></button>
            <button class="icon-btn icon-btn--gradient" onclick="showNewEventModal()" title="New Event" style="background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%); font-size: 20px;"></button>
            <button class="icon-btn" onclick="archiveCompleted()" title="Archive Completed Tasks"></button>
            <button class="icon-btn" onclick="toggleArchive()" title="View Archive"></button>
            <button class="icon-btn" onclick="toggleStats()" title="Statistics"></button>
            <button class="icon-btn" onclick="toggleSettings()" title="Settings"></button>
            <button class="icon-btn" onclick="toggleTheme()" title="Toggle Theme"></button>
        </div>
    </div>

    <!-- Focus Mode Banner -->
    <div class="focus-banner hidden" id="focusBanner">
        <div class="focus-banner-content">
            <span class="focus-banner-icon"></span>
            <span class="focus-banner-text">FOCUSING ON:</span>
            <span class="focus-banner-task" id="focusBannerTask"></span>
            <button class="focus-banner-stop" id="focusBannerStop" onclick="stopFocusFromBanner()">Stop Focus</button>
        </div>
    </div>

    <!-- Brain Dump Input -->
    <div class="brain-dump-container">
        <input type="text" 
               id="brainDumpInput" 
               class="brain-dump-input" 
               placeholder="What needs to happen?"
               onkeypress="handleBrainDump(event)">
    </div>

    <div class="main-container" id="mainContainer">
        <!-- Central Task Area -->
        <div class="tasks-center">
            <!-- Full Calendar Frame View -->
            <div class="calendar-frame-view" id="calendarFrameView">
                <div class="calendar-frame-header">
                    <h2 class="calendar-frame-title"> Calendar</h2>
                    <button class="calendar-back-btn" onclick="closeCalendarFrame()" title="Back to Tasks">
                         Back to Tasks
                    </button>
                </div>
                <div class="calendar-frame-nav">
                    <button class="calendar-frame-nav-btn" onclick="calendarFramePrev()" title="Previous period"> Previous</button>
                    <span class="calendar-frame-month" id="calendarFrameMonth">December 2024</span>
                    <button class="calendar-frame-nav-btn" onclick="calendarFrameNext()" title="Next period">Next </button>
                    <div class="calendar-view-toggle">
                        <button class="calendar-view-btn active" id="monthViewBtn" onclick="setCalendarView('month')" title="Month view">Month</button>
                        <button class="calendar-view-btn" id="weekViewBtn" onclick="setCalendarView('week')" title="Week view">Week</button>
                        <button class="calendar-view-btn" id="dayViewBtn" onclick="setCalendarView('day')" title="Day view">Day</button>
                    </div>
                </div>
                <!-- Month View Grid -->
                <div class="calendar-frame-grid active" id="calendarFrameGrid">
                    <!-- Calendar will be rendered here -->
                </div>
                <!-- Week View -->
                <div class="calendar-week-view" id="calendarWeekView">
                    <!-- Week view will be rendered here -->
                </div>
                <!-- Day View -->
                <div class="calendar-day-view" id="calendarDayView">
                    <!-- Day view will be rendered here -->
                </div>
                <div class="calendar-frame-footer">
                    <div class="calendar-google-info">
                        <span class="calendar-google-status" id="calendarFrameGoogleStatus">Google Calendar not connected</span>
                    </div>
                    <button class="google-connect-btn" onclick="connectGoogleCalendar()" title="Connect to Google Calendar to see your events">
                        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Connect Google Calendar
                    </button>
                </div>
                <!-- Calendar Picker -->
                <div class="calendar-picker-section" id="calendarPickerSection" style="display: none;">
                    <div class="calendar-picker-header">
                        <span class="calendar-picker-title">Select Calendars to Display</span>
                        <button class="calendar-picker-toggle" onclick="toggleAllCalendars()" title="Select or deselect all calendars">Toggle All</button>
                    </div>
                    <div class="calendar-picker-list" id="calendarPickerList">
                        <!-- Calendar items will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Tasks Content (toggled with calendar) -->
            <div class="tasks-content" id="tasksContent">
            <div class="container">
                <div class="date-stamp" id="dateStamp"></div>

        <!-- ZONE A: Must Get Done / Someone Else Relying On Me -->
        <div class="zone critical" id="criticalZone">
            <div class="zone-header">
                <h2 class="zone-title"> MUST GET DONE/SOMEONE ELSE RELYING ON ME</h2>
            </div>
            <div id="criticalTasks" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE B: Today -->
        <div class="zone today" id="todayZone">
            <div class="zone-header">
                <h2 class="zone-title"> Today</h2>
            </div>
            <div id="todayTasksZone" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE C: Tomorrow -->
        <div class="zone tomorrow" id="tomorrowZone">
            <div class="zone-header">
                <h2 class="zone-title"> Tomorrow</h2>
            </div>
            <div id="tomorrowTasksZone" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE D: This Week -->
        <div class="zone week" id="weekZone">
            <div class="zone-header">
                <h2 class="zone-title"> This Week</h2>
            </div>
            <div id="weekTasksZone" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE E: Today's Focus -->
        <div class="zone focus" id="focusZone">
            <div class="zone-header">
                <h2 class="zone-title"> Today's Focus</h2>
            </div>
            <div id="focusTasks" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE F: The Inbox -->
        <div class="zone inbox" id="inboxZone">
            <div class="zone-header">
                <h2 class="zone-title"> The Inbox</h2>
                <button class="refine-inbox-btn" onclick="openRefineInboxModal()" title="Refine inbox tasks"> Refine</button>
            </div>
            <div id="inboxTasks" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- ZONE G: Would Be Nice -->
        <div class="zone nice" id="niceZone">
            <div class="zone-header">
                <h2 class="zone-title"> Would Be Nice</h2>
            </div>
            <div id="niceTasks" class="task-list">
                <!-- Tasks will be rendered here -->
            </div>
        </div>

        <!-- TODAY SECTION (kept for backwards compatibility, hidden by default) -->
        <div class="section" id="todaySection" style="display: none;">
            <div class="section-header">
                <div class="section-title-group">
                    <span class="badge badge-today">Today</span>
                    <h1>Today</h1>
                </div>
                <div class="progress-ring" id="todayProgress">
                    <svg width="40" height="40" class="progress-circle">
                        <circle class="progress-circle-bg" cx="20" cy="20" r="16"></circle>
                        <circle class="progress-circle-fill" cx="20" cy="20" r="16"
                                stroke-dasharray="100.48" stroke-dashoffset="100.48"></circle>
                    </svg>
                    <div class="progress-text">0%</div>
                </div>
            </div>

            <div id="todayTasks">
                <!-- Tasks will be rendered here -->
            </div>

            <div class="quick-add">
                <input type="text" id="quickAddToday" placeholder="Quick add task (press Enter)"
                       onkeypress="handleQuickAdd(event, 'today')">
                <button onclick="addQuickTask('today')">+ Task</button>
                <button onclick="createNewGroup('today')" class="new-project-btn">+ Project</button>
            </div>
        </div>

        <!-- LONG-TERM SECTION (kept for backwards compatibility, hidden by default) -->
        <div class="section" id="longtermSection" style="display: none;">
            <div class="section-header">
                <div class="section-title-group">
                    <span class="badge badge-longterm">Long-term</span>
                    <h1>Ongoing Projects</h1>
                </div>
                <div class="progress-ring" id="longtermProgress">
                    <svg width="40" height="40" class="progress-circle">
                        <circle class="progress-circle-bg" cx="20" cy="20" r="16"></circle>
                        <circle class="progress-circle-fill" cx="20" cy="20" r="16"
                                stroke-dasharray="100.48" stroke-dashoffset="100.48"></circle>
                    </svg>
                    <div class="progress-text">0%</div>
                </div>
            </div>

            <div id="longtermTasks">
                <!-- Tasks will be rendered here -->
            </div>

            <div class="quick-add">
                <input type="text" id="quickAddLongterm" placeholder="Quick add task (press Enter)"
                       onkeypress="handleQuickAdd(event, 'longterm')">
                <button onclick="addQuickTask('longterm')">+ Task</button>
                <button onclick="createNewGroup('longterm')" class="new-project-btn">+ Project</button>
            </div>
        </div>
            </div>
            </div><!-- End tasks-content -->
        </div>

        <!-- Left Sidebar -->
        <div class="left-sidebar">
            <!-- Calendar Widget - Moved to top for immediate visibility -->
            <div class="embedded-section" style="padding-top: 12px;">
                <div class="embedded-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Quick Calendar</span>
                    <button class="expand-calendar-btn" onclick="openFullCalendar()" title="Open full calendar view"></button>
                </div>
                <div id="calendarWidget" class="calendar-widget"></div>
                <div class="quick-links-section" style="margin-top: 12px;">
                    <a href="https://calendar.google.com/calendar/u/0/r" target="_blank" class="resource-link">
                        <span class="resource-title"> Google Calendar</span>
                    </a>
                    <a href="https://sandwich-project-platform-final-katielong2316.replit.app/" target="_blank" class="resource-link">
                        <span class="resource-title"> TSP Platform</span>
                    </a>
                </div>
            </div>

            <!-- Notes Section -->
            <div class="notes-section">
                <div class="notes-header">
                    <span> Notes</span>
                    <button class="add-note-btn" onclick="addNewNote()" title="Add note">+</button>
                </div>
                <div class="notes-tag-filter" id="notesTagFilter">
                    <!-- Tag filters will be rendered here -->
                </div>
                <div class="notes-list" id="notesList">
                    <!-- Notes will be rendered here -->
                </div>
            </div>

            <!-- TSP Resources -->
            <div class="resources-section">
                <div class="resources-header">TSP Resources</div>
                <div class="resource-list">
                    <a href="https://nicunursekatie.github.io/sandwichinventory/donation-receipt-generator-with-logo.html" target="_blank" class="resource-link">
                        <span class="resource-title">    Donation Receipt Generator</span>
                    </a>
                    <a href="https://nicunursekatie.github.io/sandwichinventory/view-responses.html" target="_blank" class="resource-link">
                        <span class="resource-title"> November Recipient Survey Response Viewer</span>
                    </a>
                    <a href="https://nicunursekatie.github.io/sandwichinventory/expandedrecipientsurvey-firebase.html" target="_blank" class="resource-link">
                        <span class="resource-title"> Link to Recipient Survey Already Sent Out</span>
                    </a>
                    <a href="https://nicunursekatie.github.io/sandwichprojectcollectionsites/" target="_blank" class="resource-link">
                        <span class="resource-title"> Host Finder Tool</span>
                    </a>
                    <a href="https://nicunursekatie.github.io/sandwichinventory/toolkit.html" target="_blank" class="resource-link">
                        <span class="resource-title"> Group Event Toolkit Website</span>
                    </a>
                    <a href="https://nicunursekatie.github.io/sandwichinventory/inventorycalculator.html" target="_blank" class="resource-link">
                        <span class="resource-title"> Sandwich Budget & Shopping Planner</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Panel -->
    <div class="stats-panel" id="statsPanel">
        <div class="panel-header">
            <h2> Statistics</h2>
            <button class="close-btn" onclick="toggleStats()" title="Close statistics"></button>
        </div>

        <div class="stat-card">
            <div class="stat-label">Completed Today</div>
            <div class="stat-value" id="statCompletedToday">0</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Total Tasks</div>
            <div class="stat-value" id="statTotalTasks">0</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Completion Rate</div>
            <div class="stat-value" id="statCompletionRate">0%</div>
        </div>

        <div class="stat-card">
            <div class="stat-label">Active Projects</div>
            <div class="stat-value" id="statActiveProjects">0</div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="panel-header">
            <h2> Settings</h2>
            <button class="close-btn" onclick="toggleSettings()" title="Close settings"></button>
        </div>

        <div class="setting-item">
            <div class="setting-label">Dark Mode</div>
            <div class="toggle-switch" id="darkModeToggle" onclick="toggleTheme()"></div>
        </div>

        <div class="setting-item">
            <div class="setting-label">Show Completed</div>
            <div class="toggle-switch active" id="showCompletedToggle" onclick="toggleShowCompleted()"></div>
        </div>

        <div class="setting-item">
            <div class="setting-label">Auto-save</div>
            <div class="toggle-switch active"></div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); display: block;">
            <div class="setting-label" style="margin-bottom: 8px;"> Focus Mode Alert Interval</div>
            <select id="focusAlertInterval" onchange="updateFocusAlertInterval()"
                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 14px; cursor: pointer;">
                <option value="1">1 minute</option>
                <option value="2">2 minutes</option>
                <option value="3">3 minutes</option>
                <option value="4">4 minutes</option>
                <option value="5">5 minutes</option>
                <option value="6">6 minutes</option>
                <option value="7">7 minutes</option>
                <option value="8">8 minutes</option>
                <option value="9">9 minutes</option>
                <option value="10">10 minutes</option>
                <option value="11">11 minutes</option>
                <option value="12">12 minutes</option>
                <option value="13">13 minutes</option>
                <option value="14">14 minutes</option>
                <option value="15">15 minutes</option>
            </select>
            <div style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 6px; line-height: 1.4;">
                 When you focus on a task ( button), you'll be asked to set an alert interval (1-15 min) and optionally link a website. This setting is the default for new focus sessions.
            </div>
            <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 11px;">
                <strong> Testing:</strong><br>
                 Type <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">checkFocusStatus()</code> in console to check status<br>
                 Type <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">testFocusAlert()</code> in console to test alert immediately
            </div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-top: 24px; display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">Google Maps API Key </div>
            <div style="display: flex; gap: 8px;">
                <input type="password" id="googleMapsApiKey" placeholder="AIza..."
                       style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px; font-family: monospace;"
                       onchange="saveAPIKeys()">
                <button onclick="testGoogleMapsKey()" title="Test Google Maps API key"
                        style="padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    Test
                </button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;">
                Get key: console.cloud.google.com  APIs & Services  Credentials<br>
                Enable: Maps JavaScript API, Places API, Geocoding API
            </div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-top: 24px; display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">AI Provider </div>
            <select id="aiProvider" onchange="saveAIProvider()"
                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 14px; cursor: pointer;">
                <option value="gemini">Google Gemini 2.0 Flash (Recommended - Free)</option>
                <option value="groq">Groq (Llama 3.3 70B - Fast & Free)</option>
                <option value="anthropic">Anthropic Claude (Premium)</option>
                <option value="openai">OpenAI (CORS Issues - Use at Own Risk)</option>
            </select>
            <div style="font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 6px; line-height: 1.4;">
                 Gemini & Groq work directly from browser with free tiers!
            </div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">OpenAI API Key</div>
            <div style="display: flex; gap: 8px;">
                <input type="password" id="openaiApiKey" placeholder="sk-proj-..."
                       style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px; font-family: monospace;"
                       onchange="saveAPIKeys()">
                <button onclick="testOpenAIKey()" title="Test OpenAI API key"
                        style="padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    Test
                </button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;">Note: Won't work from browser (CORS issue)</div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">Gemini API Key </div>
            <div style="display: flex; gap: 8px;">
                <input type="password" id="geminiApiKey" placeholder="AIza..."
                       style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px; font-family: monospace;"
                       onchange="saveAPIKeys()">
                <button onclick="testGeminiKey()" title="Test Gemini API key"
                        style="padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    Test
                </button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;">Get free key: aistudio.google.com/apikey</div>
        </div>

        <div class="setting-item" style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">Groq API Key (Free) </div>
            <div style="display: flex; gap: 8px;">
                <input type="password" id="groqApiKey" placeholder="gsk_..."
                       style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px; font-family: monospace;"
                       onchange="saveAPIKeys()">
                <button onclick="testGroqKey()" title="Test Groq API key"
                        style="padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    Test
                </button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;">Get free key: console.groq.com</div>
        </div>

        <div class="setting-item" style="border-bottom: none; display: block;">
            <div class="setting-label" style="margin-bottom: 8px;">Anthropic API Key</div>
            <div style="display: flex; gap: 8px;">
                <input type="password" id="anthropicApiKey" placeholder="sk-ant-..."
                       style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.1); color: white; font-size: 13px; font-family: monospace;"
                       onchange="saveAPIKeys()">
                <button onclick="testAnthropicKey()" title="Test Anthropic API key"
                        style="padding: 10px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.3); background: rgba(255,255,255,0.15); color: white; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap;">
                    Test
                </button>
            </div>
            <div style="font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 6px;">Get key: console.anthropic.com</div>
        </div>

        <div class="setting-item" style="border: none; padding-top: 24px;">
            <button style="width: 100%; padding: 12px; background: var(--accent-today); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;" onclick="clearAllData()">
                Clear All Data
            </button>
        </div>
    </div>

    <!-- Archive Panel -->
    <div class="settings-panel" id="archivePanel">
        <div class="panel-header">
            <h2> Archived Tasks</h2>
            <button class="close-btn" onclick="toggleArchive()" title="Close archive"></button>
        </div>

        <div id="archiveContent" style="max-height: 70vh; overflow-y: auto; padding: 10px;">
            <!-- Archive content will be populated by JavaScript -->
        </div>

        <div class="setting-item" style="border: none; padding-top: 24px;">
            <button style="width: 100%; padding: 12px; background: var(--accent-today); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;" onclick="clearArchive()">
                Clear Archive
            </button>
        </div>
    </div>

    <!-- Custom Input Modal -->
    <div id="customModal" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h3 id="modalTitle">Input Required</h3>
                <button class="modal-close-btn" onclick="closeCustomModal()" title="Close modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <p id="modalMessage"></p>
                <textarea id="modalInput" rows="4" placeholder="Enter your response..."></textarea>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeCustomModal()">Cancel</button>
                <button class="modal-btn modal-btn-submit" onclick="submitCustomModal()">Submit</button>
            </div>
        </div>
    </div>

    <!-- New Task Modal -->
    <div id="newTaskModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 500px;">
            <div class="custom-modal-header">
                <h3> New Task</h3>
                <button class="modal-close-btn" onclick="closeNewTaskModal()" title="Close new task modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Task Title</label>
                    <input type="text" id="newTaskTitle"
                           placeholder="What needs to be done?"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Add to:</label>
                    <div style="display: flex; gap: 12px;">
                        <label style="flex: 1; cursor: pointer;">
                            <input type="radio" name="newTaskSection" value="today" checked style="margin-right: 8px;">
                            <span style="font-weight: 500;"> Today</span>
                        </label>
                        <label style="flex: 1; cursor: pointer;">
                            <input type="radio" name="newTaskSection" value="longterm" style="margin-right: 8px;">
                            <span style="font-weight: 500;"> Long-term</span>
                        </label>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Project (optional)</label>
                    <select id="newTaskProject"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="">-- No project --</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Due Date (optional)</label>
                    <input type="text" id="newTaskDueDate" placeholder="tomorrow, next Friday, 2024-12-25..."
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    <div style="font-size: 11px; color: #666; margin-top: 4px;">
                        Try: tomorrow, next week, friday, in 3 days, or YYYY-MM-DD
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Estimated Time (optional)</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="newTaskEstimate" min="1" placeholder="15"
                               style="width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <span style="color: #666; font-size: 14px;">minutes</span>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Emotional Weight (optional)</label>
                    <select id="newTaskEmotionalWeight"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="">-- None --</option>
                        <option value="light"> Light (Easy, no stress)</option>
                        <option value="moderate"> Moderate (Some mental effort)</option>
                        <option value="heavy"> Heavy (Mentally demanding)</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Status (optional)</label>
                    <select id="newTaskStatus"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="not-started"> Not Started</option>
                        <option value="planning"> Planning</option>
                        <option value="in-progress"> In Progress</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Tags (optional)</label>
                    <input type="text" id="newTaskTags"
                           placeholder="work, urgent, personal, etc. (comma-separated)"
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    <div style="font-size: 11px; color: #666; margin-top: 4px;">
                        Separate multiple tags with commas
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Notes / Plan (optional)</label>
                    <textarea id="newTaskNotes"
                              placeholder="Write your approach, plan, or notes here..."
                              style="width: 100%; min-height: 80px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white; resize: vertical;"></textarea>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeNewTaskModal()">Cancel</button>
                <button class="modal-btn modal-btn-submit" onclick="submitNewTask()">Create Task</button>
            </div>
        </div>
    </div>

    <!-- New Project Modal -->
    <div id="newProjectModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 400px;">
            <div class="custom-modal-header">
                <h3> New Project</h3>
                <button class="modal-close-btn" onclick="closeNewProjectModal()" title="Close new project modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Project Name</label>
                    <input type="text" id="newProjectName"
                           placeholder="Enter project name..."
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeNewProjectModal()">Cancel</button>
                <button class="modal-btn modal-btn-submit" onclick="submitNewProject()">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 600px;">
            <div class="custom-modal-header">
                <h3> Edit Event</h3>
                <button class="modal-close-btn" onclick="closeEditEventModal()" title="Close edit event modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Event Title *</label>
                    <input type="text" id="editEventTitle"
                           placeholder="Meeting name, appointment, etc."
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Date *</label>
                        <input type="text" id="editEventDate" placeholder="today, tomorrow, 2024-12-25..."
                               style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Start Time *</label>
                        <input type="text" id="editEventStartTime" placeholder="2:00 PM or 14:00"
                               style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Duration</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="editEventDuration" min="15" step="15" value="60" placeholder="60"
                               style="width: 100px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <span style="color: #666; font-size: 14px;">minutes (or enter end time below)</span>
                    </div>
                    <div style="margin-top: 8px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333; font-size: 13px;">End Time (optional - overrides duration)</label>
                        <input type="text" id="editEventEndTime" placeholder="3:00 PM or 15:00"
                               style="width: 200px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Location</label>
                    <input type="text" id="editEventLocation" placeholder="Address or place name"
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    <button type="button" id="editEventLocationMapBtn" onclick="openLocationPicker('editEventLocation')" 
                            style="margin-top: 8px; padding: 8px 12px; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                         Pick on Map
                    </button>
                    <div id="editEventLocationMap" style="display: none; margin-top: 12px; height: 300px; border: 2px solid #e0e0e0; border-radius: 8px;"></div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Travel Time</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="editEventTravelTime" min="0" step="5" placeholder="0"
                               style="width: 100px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <span style="color: #666; font-size: 14px;">minutes before event (for leaving reminders)</span>
                    </div>
                    <div style="font-size: 11px; color: #666; margin-top: 4px;">
                        Leave buffer time to get to the event location
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Description</label>
                    <textarea id="editEventDescription"
                              placeholder="Notes, agenda, preparation needed..."
                              style="width: 100%; min-height: 80px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white; resize: vertical;"></textarea>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Reminders</label>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="editEventReminder15" style="width: auto;">
                            <span>15 minutes before</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="editEventReminderTravel" style="width: auto;">
                            <span>Travel time reminder (based on travel time above)</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="editEventReminder1hr" style="width: auto;">
                            <span>1 hour before</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="editEventReminder1day" style="width: auto;">
                            <span>1 day before</span>
                        </label>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="editEventAllDay" style="width: auto;">
                        <span style="font-weight: 600; color: #333;">All-day event</span>
                    </label>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeEditEventModal()">Cancel</button>
                <button class="modal-btn modal-btn-danger" onclick="deleteEvent()" style="background: #EF4444;">Delete Event</button>
                <button class="modal-btn modal-btn-submit" onclick="submitEditEvent()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Task Edit Modal -->
    <div id="taskEditModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 600px;">
            <div class="custom-modal-header">
                <h3> Edit Task</h3>
                <button class="modal-close-btn" onclick="closeTaskEditModal()" title="Close task edit modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Task Title</label>
                    <input type="text" id="taskEditTitle"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Project</label>
                    <select id="taskEditProject"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Due Date</label>
                    <input type="date" id="taskEditDueDate"
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Estimated Time</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" id="taskEditEstimate" min="1" placeholder="15"
                               style="width: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <span style="color: #666; font-size: 14px;">minutes</span>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Emotional Weight</label>
                    <select id="taskEditEmotionalWeight"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="">-- None --</option>
                        <option value="light"> Light (Easy, no stress)</option>
                        <option value="moderate"> Moderate (Some mental effort)</option>
                        <option value="heavy"> Heavy (Mentally demanding)</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Status</label>
                    <select id="taskEditStatus"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="not-started"> Not Started</option>
                        <option value="planning"> Planning</option>
                        <option value="in-progress"> In Progress</option>
                        <option value="completed"> Completed</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Tags</label>
                    <input type="text" id="taskEditTags"
                           placeholder="work, urgent, personal, etc. (comma-separated)"
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                    <div style="font-size: 11px; color: #666; margin-top: 4px;">
                        Separate multiple tags with commas
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="taskEditIsBlocking" style="width: auto;">
                        <span style="font-weight: 600; color: #333;"> Blocking others / Someone is relying on me</span>
                    </label>
                    <div style="margin-left: 28px; margin-top: 8px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="taskEditIsUrgent" style="width: auto;">
                            <span style="font-weight: 600; color: #dc2626; font-size: 13px;"> URGENT - Must get done ASAP</span>
                        </label>
                    </div>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">External Deadline (date-limited by external factors)</label>
                    <input type="date" id="taskEditExternalDeadline"
                           style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="taskEditIsInFocus" style="width: auto;">
                        <span style="font-weight: 600; color: #333;"> Add to Today's Focus</span>
                    </label>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Zone (optional)</label>
                    <select id="taskEditZone"
                            style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white;">
                        <option value="">-- Auto-assign based on properties --</option>
                        <option value="critical"> MUST GET DONE/SOMEONE ELSE RELYING ON ME</option>
                        <option value="focus"> Today's Focus</option>
                        <option value="inbox"> The Inbox</option>
                        <option value="nice"> Would Be Nice</option>
                    </select>
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Notes / Plan</label>
                    <textarea id="taskEditNotes"
                              placeholder="Write your approach, plan, or notes here..."
                              style="width: 100%; min-height: 100px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; background: white; resize: vertical;"></textarea>
                </div>
                <div id="taskEditSubtasksContainer"></div>
                <button onclick="addSubtaskInEdit()"
                        style="width: 100%; padding: 10px; background: rgba(102, 126, 234, 0.1); color: #667eea; border: 2px dashed #667eea; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 12px;">
                    + Add Subtask
                </button>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeTaskEditModal()">Cancel</button>
                <button class="modal-btn modal-btn-submit" onclick="submitTaskEdit()">Save</button>
            </div>
        </div>
    </div>

    <!-- Full Calendar Modal -->
    <div id="fullCalendarModal" class="full-calendar-modal">
        <div class="full-calendar-content">
            <div class="full-calendar-header">
                <h2>Full Calendar View</h2>
                <button class="full-calendar-close" onclick="closeFullCalendar()" title="Close full calendar"></button>
            </div>
            <div class="full-calendar-nav">
                <button class="full-calendar-nav-btn" onclick="fullCalendarPrevMonth()" title="Previous month"> Previous</button>
                <span class="full-calendar-month-year" id="fullCalendarMonthYear">December 2024</span>
                <button class="full-calendar-nav-btn" onclick="fullCalendarNextMonth()" title="Next month">Next </button>
            </div>
            <div class="full-calendar-body">
                <div class="full-calendar-grid" id="fullCalendarGrid">
                    <!-- Calendar will be rendered here -->
                </div>
            </div>
            <div class="google-connect-section">
                <div>
                    <span class="google-status" id="googleCalendarStatus">Google Calendar not connected</span>
                    <p style="margin: 4px 0 0; font-size: 11px; color: var(--text-muted);">Connect to see your Google Calendar events here</p>
                </div>
                <button class="google-connect-btn" onclick="connectGoogleCalendar()">
                    <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    Connect Google Calendar
                </button>
            </div>
        </div>
    </div>

    <!-- Let's Get To Work Session Overlay -->
    <div id="workSessionOverlay" class="work-session-overlay">
        <div class="work-session-container">
            <div class="work-session-header">
                <h1 class="work-session-title">Let's Get To Work!</h1>
                <p class="work-session-subtitle">Focus on these tasks until they're done</p>
            </div>

            <div class="work-session-timer" id="workSessionTimer">00:00:00</div>

            <div class="work-session-progress">
                <div class="work-session-progress-text">
                    <span id="workProgressText">0 of 0 tasks completed</span>
                </div>
                <div class="work-session-progress-bar">
                    <div class="work-session-progress-fill" id="workProgressFill" style="width: 0%"></div>
                </div>
            </div>

            <div class="work-session-tasks" id="workSessionTasks">
                <!-- Tasks will be rendered here -->
            </div>

            <div class="work-add-task-section">
                <div class="work-add-task-title">Add a task to this session</div>
                <div class="work-add-task-form">
                    <input type="text" class="work-add-input" id="workTaskTitle" placeholder="Task name *" required>
                    <div class="work-add-task-row">
                        <input type="text" class="work-add-input" id="workTaskLinks" placeholder="Links (comma separated)">
                        <input type="text" class="work-add-input" id="workTaskPhone" placeholder="Phone number">
                    </div>
                    <input type="text" class="work-add-input" id="workTaskNotes" placeholder="Notes (optional)">
                    <button class="work-add-btn" onclick="addWorkTask()">+ Add Task</button>
                </div>
            </div>

            <div class="work-session-actions">
                <button class="work-session-btn secondary" onclick="clearWorkSession()">Clear All</button>
                <button class="work-session-btn danger" onclick="exitWorkSession()">Exit Session</button>
                <button class="work-session-btn primary" id="workCompleteBtn" onclick="completeWorkSession()" style="display: none;">All Done!</button>
            </div>

            <div class="work-motivation">
                <p class="work-motivation-text" id="workMotivationText">"The secret of getting ahead is getting started."</p>
            </div>
        </div>
    </div>

    <!-- Calendar Widget Script -->
    <script>
        // Simple inline calendar widget
        let currentCalendarDate = new Date();
        let selectedDate = null;

        function renderCalendar() {
            const widget = document.getElementById('calendarWidget');
            const today = new Date();
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            let html = `
                <div class="calendar-header">
                    <div class="calendar-month">${monthNames[month]} ${year}</div>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)" title="Previous month"></button>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)" title="Next month"></button>
                    </div>
                </div>
                <div class="calendar-days">
                    <div class="calendar-day-name">S</div>
                    <div class="calendar-day-name">M</div>
                    <div class="calendar-day-name">T</div>
                    <div class="calendar-day-name">W</div>
                    <div class="calendar-day-name">T</div>
                    <div class="calendar-day-name">F</div>
                    <div class="calendar-day-name">S</div>
                </div>
                <div class="calendar-dates">
            `;

            // Previous month's trailing days
            for (let i = firstDay - 1; i >= 0; i--) {
                const date = daysInPrevMonth - i;
                html += `<div class="calendar-date other-month">${date}</div>`;
            }

            // Current month's days
            for (let date = 1; date <= daysInMonth; date++) {
                const isToday = date === today.getDate() &&
                    month === today.getMonth() &&
                    year === today.getFullYear();

                const isSelected = selectedDate &&
                    date === selectedDate.getDate() &&
                    month === selectedDate.getMonth() &&
                    year === selectedDate.getFullYear();

                const classes = ['calendar-date'];
                if (isToday) classes.push('today');
                if (isSelected) classes.push('selected');

                html += `<div class="${classes.join(' ')}" onclick="selectDate(${year}, ${month}, ${date})">${date}</div>`;
            }

            // Next month's leading days
            const totalCells = firstDay + daysInMonth;
            const remainingCells = 7 - (totalCells % 7);
            if (remainingCells < 7) {
                for (let date = 1; date <= remainingCells; date++) {
                    html += `<div class="calendar-date other-month">${date}</div>`;
                }
            }

            html += `</div>`;
            widget.innerHTML = html;
        }

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function selectDate(year, month, date) {
            selectedDate = new Date(year, month, date);
            renderCalendar();
        }

        // Initialize calendar on load
        window.addEventListener('load', renderCalendar);

        // ===== FULL CALENDAR FUNCTIONS =====
        let fullCalendarDate = new Date();
        let googleCalendarEvents = []; // Will store Google Calendar events

        function openFullCalendar() {
            // Now opens in the main frame instead of modal
            openCalendarFrame();
        }

        function closeFullCalendar() {
            closeCalendarFrame();
        }

        // ===== IN-FRAME CALENDAR VIEW =====
        let calendarFrameDate = new Date();

        function openCalendarFrame() {
            const calendarView = document.getElementById('calendarFrameView');
            const tasksContent = document.getElementById('tasksContent');

            calendarFrameDate = new Date(currentCalendarDate); // Sync with small calendar
            calendarView.classList.add('active');
            tasksContent.classList.add('hidden');
            renderCalendarFrame();
        }

        function closeCalendarFrame() {
            const calendarView = document.getElementById('calendarFrameView');
            const tasksContent = document.getElementById('tasksContent');

            calendarView.classList.remove('active');
            tasksContent.classList.remove('hidden');
        }

        function calendarFramePrevMonth() {
            calendarFrameDate.setMonth(calendarFrameDate.getMonth() - 1);
            renderCalendarFrame();
        }

        function calendarFrameNextMonth() {
            calendarFrameDate.setMonth(calendarFrameDate.getMonth() + 1);
            renderCalendarFrame();
        }

        function renderCalendarFrame() {
            const grid = document.getElementById('calendarFrameGrid');
            const monthLabel = document.getElementById('calendarFrameMonth');
            const today = new Date();
            const year = calendarFrameDate.getFullYear();
            const month = calendarFrameDate.getMonth();

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            monthLabel.textContent = `${monthNames[month]} ${year}`;

            // Get tasks with due dates for this month
            const tasksWithDueDates = getTasksForMonth(year, month);

            let html = `
                <div class="calendar-frame-day-name">Sun</div>
                <div class="calendar-frame-day-name">Mon</div>
                <div class="calendar-frame-day-name">Tue</div>
                <div class="calendar-frame-day-name">Wed</div>
                <div class="calendar-frame-day-name">Thu</div>
                <div class="calendar-frame-day-name">Fri</div>
                <div class="calendar-frame-day-name">Sat</div>
            `;

            // Previous month's trailing days
            for (let i = firstDay - 1; i >= 0; i--) {
                const date = daysInPrevMonth - i;
                html += `<div class="calendar-frame-day other-month">
                    <div class="calendar-frame-day-number">${date}</div>
                </div>`;
            }

            // Current month's days
            for (let date = 1; date <= daysInMonth; date++) {
                const isToday = date === today.getDate() &&
                    month === today.getMonth() &&
                    year === today.getFullYear();

                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayTasks = tasksWithDueDates[dateStr] || [];
                const filteredEvents = getFilteredGoogleEvents();
                const dayGoogleEvents = filteredEvents.filter(e => e.date === dateStr);

                const classes = ['calendar-frame-day'];
                if (isToday) classes.push('today');

                let eventsHtml = '';

                // Show tasks
                const shownTasks = dayTasks.slice(0, 3);
                shownTasks.forEach(task => {
                    eventsHtml += `<div class="calendar-frame-event" title="${task.text}">${task.text}</div>`;
                });

                // Show Google Calendar events
                const shownGoogleEvents = dayGoogleEvents.slice(0, 2);
                shownGoogleEvents.forEach(event => {
                    eventsHtml += `<div class="calendar-frame-event google" title="${event.title}">${event.title}</div>`;
                });

                const totalEvents = dayTasks.length + dayGoogleEvents.length;
                const shownEvents = shownTasks.length + shownGoogleEvents.length;
                if (totalEvents > shownEvents) {
                    eventsHtml += `<div class="calendar-frame-more">+${totalEvents - shownEvents} more</div>`;
                }

                html += `<div class="${classes.join(' ')}" onclick="selectCalendarFrameDate(${year}, ${month}, ${date})">
                    <div class="calendar-frame-day-number">${date}</div>
                    <div class="calendar-frame-events">${eventsHtml}</div>
                </div>`;
            }

            // Next month's leading days
            const totalCells = firstDay + daysInMonth;
            const remainingCells = (7 - (totalCells % 7)) % 7;
            for (let date = 1; date <= remainingCells; date++) {
                html += `<div class="calendar-frame-day other-month">
                    <div class="calendar-frame-day-number">${date}</div>
                </div>`;
            }

            grid.innerHTML = html;
        }

        function selectCalendarFrameDate(year, month, date) {
            // Sync with the small calendar
            currentCalendarDate = new Date(year, month, 1);
            selectedDate = new Date(year, month, date);
            calendarFrameDate = new Date(year, month, date);
            renderCalendar();
            // Switch to day view when clicking a date
            setCalendarView('day');
        }

        // ===== CALENDAR VIEW SWITCHING =====
        let currentCalendarView = 'month'; // 'month', 'week', 'day'

        function setCalendarView(view) {
            currentCalendarView = view;

            // Update button states
            document.getElementById('monthViewBtn').classList.remove('active');
            document.getElementById('weekViewBtn').classList.remove('active');
            document.getElementById('dayViewBtn').classList.remove('active');
            document.getElementById(view + 'ViewBtn').classList.add('active');

            // Hide all views
            document.getElementById('calendarFrameGrid').classList.remove('active');
            document.getElementById('calendarWeekView').classList.remove('active');
            document.getElementById('calendarDayView').classList.remove('active');

            // Show selected view
            if (view === 'month') {
                document.getElementById('calendarFrameGrid').classList.add('active');
                renderCalendarFrame();
            } else if (view === 'week') {
                document.getElementById('calendarWeekView').classList.add('active');
                renderWeekView();
            } else if (view === 'day') {
                document.getElementById('calendarDayView').classList.add('active');
                renderDayView();
            }

            updateCalendarLabel();
        }

        function calendarFramePrev() {
            if (currentCalendarView === 'month') {
                calendarFrameDate.setMonth(calendarFrameDate.getMonth() - 1);
                renderCalendarFrame();
            } else if (currentCalendarView === 'week') {
                calendarFrameDate.setDate(calendarFrameDate.getDate() - 7);
                renderWeekView();
            } else if (currentCalendarView === 'day') {
                calendarFrameDate.setDate(calendarFrameDate.getDate() - 1);
                renderDayView();
            }
            updateCalendarLabel();
        }

        function calendarFrameNext() {
            if (currentCalendarView === 'month') {
                calendarFrameDate.setMonth(calendarFrameDate.getMonth() + 1);
                renderCalendarFrame();
            } else if (currentCalendarView === 'week') {
                calendarFrameDate.setDate(calendarFrameDate.getDate() + 7);
                renderWeekView();
            } else if (currentCalendarView === 'day') {
                calendarFrameDate.setDate(calendarFrameDate.getDate() + 1);
                renderDayView();
            }
            updateCalendarLabel();
        }

        function updateCalendarLabel() {
            const monthLabel = document.getElementById('calendarFrameMonth');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            if (currentCalendarView === 'month') {
                monthLabel.textContent = `${monthNames[calendarFrameDate.getMonth()]} ${calendarFrameDate.getFullYear()}`;
            } else if (currentCalendarView === 'week') {
                const startOfWeek = new Date(calendarFrameDate);
                startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());
                const endOfWeek = new Date(startOfWeek);
                endOfWeek.setDate(endOfWeek.getDate() + 6);

                if (startOfWeek.getMonth() === endOfWeek.getMonth()) {
                    monthLabel.textContent = `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
                } else {
                    monthLabel.textContent = `${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()} - ${monthNames[endOfWeek.getMonth()]} ${endOfWeek.getDate()}, ${startOfWeek.getFullYear()}`;
                }
            } else if (currentCalendarView === 'day') {
                monthLabel.textContent = `${dayNames[calendarFrameDate.getDay()]}, ${monthNames[calendarFrameDate.getMonth()]} ${calendarFrameDate.getDate()}, ${calendarFrameDate.getFullYear()}`;
            }
        }

        // ===== WEEK VIEW =====
        function renderWeekView() {
            const container = document.getElementById('calendarWeekView');
            const today = new Date();
            const filteredEvents = getFilteredGoogleEvents();

            // Get start of week (Sunday)
            const startOfWeek = new Date(calendarFrameDate);
            startOfWeek.setDate(startOfWeek.getDate() - startOfWeek.getDay());

            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // Build header
            let headerHtml = '<div class="calendar-week-header"><div></div>';
            const weekDates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(date.getDate() + i);
                weekDates.push(date);

                const isToday = date.toDateString() === today.toDateString();
                headerHtml += `
                    <div class="calendar-week-header-cell ${isToday ? 'today' : ''}" onclick="goToDay(${date.getFullYear()}, ${date.getMonth()}, ${date.getDate()})">
                        <div class="calendar-week-day-name">${dayNames[i]}</div>
                        <div class="calendar-week-day-number">${date.getDate()}</div>
                    </div>
                `;
            }
            headerHtml += '</div>';

            // Build all-day events row
            let allDayHtml = '<div class="calendar-week-all-day-row"><div class="calendar-week-all-day-label">All day</div>';
            for (let i = 0; i < 7; i++) {
                const dateStr = formatDateStr(weekDates[i]);
                const allDayEvents = filteredEvents.filter(e => e.date === dateStr && e.startTime === 'All day');

                allDayHtml += '<div class="calendar-week-all-day-cell">';
                allDayEvents.forEach(event => {
                    const color = event.calendarColor || '#4285F4';
                    allDayHtml += `<div class="calendar-week-all-day-event" style="background: ${color}" title="${event.title}">${event.title}</div>`;
                });
                allDayHtml += '</div>';
            }
            allDayHtml += '</div>';

            // Build time grid
            let bodyHtml = '<div class="calendar-week-body"><div class="calendar-week-time-column">';
            for (let hour = 0; hour < 24; hour++) {
                const timeStr = hour === 0 ? '12 AM' : hour < 12 ? `${hour} AM` : hour === 12 ? '12 PM' : `${hour - 12} PM`;
                bodyHtml += `<div class="calendar-week-time-slot">${timeStr}</div>`;
            }
            bodyHtml += '</div>';

            // Day columns with events
            for (let i = 0; i < 7; i++) {
                const dateStr = formatDateStr(weekDates[i]);
                const dayEvents = filteredEvents.filter(e => e.date === dateStr && e.startTime !== 'All day');

                bodyHtml += '<div class="calendar-week-day-column">';

                // Hour slots
                for (let hour = 0; hour < 24; hour++) {
                    bodyHtml += `<div class="calendar-week-hour-slot" data-hour="${hour}"></div>`;
                }

                // Position events
                dayEvents.forEach(event => {
                    const startHour = parseTimeToHour(event.startTime);
                    const endHour = event.endTime ? parseTimeToHour(event.endTime) : startHour + 1;
                    const duration = Math.max(endHour - startHour, 0.5);
                    const top = startHour * 60;
                    const height = Math.max(duration * 60 - 2, 20);
                    const color = event.calendarColor || '#4285F4';

                    bodyHtml += `
                        <div class="calendar-week-event" style="top: ${top}px; height: ${height}px; background: ${color};" title="${event.title}">
                            <div class="calendar-week-event-title">${event.title}</div>
                            <div class="calendar-week-event-time">${event.startTime}${event.endTime ? ' - ' + event.endTime : ''}</div>
                        </div>
                    `;
                });

                bodyHtml += '</div>';
            }
            bodyHtml += '</div>';

            container.innerHTML = headerHtml + allDayHtml + bodyHtml;

            // Scroll to 8 AM by default
            const bodyEl = container.querySelector('.calendar-week-body');
            if (bodyEl) {
                bodyEl.scrollTop = 8 * 60;
            }
        }

        // ===== DAY VIEW =====
        function renderDayView() {
            const container = document.getElementById('calendarDayView');
            const today = new Date();
            const filteredEvents = getFilteredGoogleEvents();
            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

            const dateStr = formatDateStr(calendarFrameDate);
            const isToday = calendarFrameDate.toDateString() === today.toDateString();
            const dayEvents = filteredEvents.filter(e => e.date === dateStr);
            const allDayEvents = dayEvents.filter(e => e.startTime === 'All day');
            const timedEvents = dayEvents.filter(e => e.startTime !== 'All day');

            // Header
            let html = `
                <div class="calendar-day-header ${isToday ? 'today' : ''}">
                    <div class="calendar-day-header-name">${dayNames[calendarFrameDate.getDay()]}</div>
                    <div class="calendar-day-header-number">${calendarFrameDate.getDate()}</div>
                </div>
            `;

            // All-day events
            html += '<div class="calendar-day-all-day-section">';
            if (allDayEvents.length > 0) {
                html += '<div class="calendar-day-all-day-label">All Day</div>';
                html += '<div class="calendar-day-all-day-events">';
                allDayEvents.forEach(event => {
                    const color = event.calendarColor || '#4285F4';
                    html += `<div class="calendar-day-all-day-event" style="background: ${color}">${event.title}</div>`;
                });
                html += '</div>';
            }
            html += '</div>';

            // Time schedule
            html += '<div class="calendar-day-schedule"><div class="calendar-day-time-column">';
            for (let hour = 0; hour < 24; hour++) {
                const timeStr = hour === 0 ? '12 AM' : hour < 12 ? `${hour} AM` : hour === 12 ? '12 PM' : `${hour - 12} PM`;
                html += `<div class="calendar-day-time-slot">${timeStr}</div>`;
            }
            html += '</div><div class="calendar-day-events-column">';

            // Hour slots
            for (let hour = 0; hour < 24; hour++) {
                html += `<div class="calendar-day-hour-slot"></div>`;
            }

            // Position timed events
            timedEvents.forEach(event => {
                const startHour = parseTimeToHour(event.startTime);
                const endHour = event.endTime ? parseTimeToHour(event.endTime) : startHour + 1;
                const duration = Math.max(endHour - startHour, 0.5);
                const top = startHour * 60;
                const height = Math.max(duration * 60 - 4, 30);
                const color = event.calendarColor || '#4285F4';

                html += `
                    <div class="calendar-day-event" style="top: ${top}px; height: ${height}px; background: ${color};">
                        <div class="calendar-day-event-title">${event.title}</div>
                        <div class="calendar-day-event-time">${event.startTime}${event.endTime ? ' - ' + event.endTime : ''}</div>
                        ${event.location ? `<div class="calendar-day-event-location"> ${event.location}</div>` : ''}
                    </div>
                `;
            });

            html += '</div></div>';

            container.innerHTML = html;

            // Scroll to 8 AM by default
            const scheduleEl = container.querySelector('.calendar-day-schedule');
            if (scheduleEl) {
                scheduleEl.scrollTop = 8 * 60;
            }
        }

        // Helper functions
        function formatDateStr(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function parseTimeToHour(timeStr) {
            if (!timeStr || timeStr === 'All day') return 0;
            const match = timeStr.match(/(\d+):(\d+)\s*(AM|PM)?/i);
            if (!match) return 0;

            let hour = parseInt(match[1]);
            const minutes = parseInt(match[2]) / 60;
            const period = match[3];

            if (period) {
                if (period.toUpperCase() === 'PM' && hour !== 12) hour += 12;
                if (period.toUpperCase() === 'AM' && hour === 12) hour = 0;
            }

            return hour + minutes;
        }

        function goToDay(year, month, date) {
            calendarFrameDate = new Date(year, month, date);
            setCalendarView('day');
        }

        // Make frame calendar functions globally available
        window.openCalendarFrame = openCalendarFrame;
        window.closeCalendarFrame = closeCalendarFrame;
        window.calendarFramePrev = calendarFramePrev;
        window.calendarFrameNext = calendarFrameNext;
        window.selectCalendarFrameDate = selectCalendarFrameDate;
        window.setCalendarView = setCalendarView;
        window.goToDay = goToDay;

        // Close modal when clicking outside
        document.getElementById('fullCalendarModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeFullCalendar();
            }
        });

        function fullCalendarPrevMonth() {
            fullCalendarDate.setMonth(fullCalendarDate.getMonth() - 1);
            renderFullCalendar();
        }

        function fullCalendarNextMonth() {
            fullCalendarDate.setMonth(fullCalendarDate.getMonth() + 1);
            renderFullCalendar();
        }

        function renderFullCalendar() {
            const grid = document.getElementById('fullCalendarGrid');
            const monthYearLabel = document.getElementById('fullCalendarMonthYear');
            const today = new Date();
            const year = fullCalendarDate.getFullYear();
            const month = fullCalendarDate.getMonth();

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            monthYearLabel.textContent = `${monthNames[month]} ${year}`;

            // Get tasks with due dates for this month
            const tasksWithDueDates = getTasksForMonth(year, month);

            let html = `
                <div class="full-calendar-day-name">Sun</div>
                <div class="full-calendar-day-name">Mon</div>
                <div class="full-calendar-day-name">Tue</div>
                <div class="full-calendar-day-name">Wed</div>
                <div class="full-calendar-day-name">Thu</div>
                <div class="full-calendar-day-name">Fri</div>
                <div class="full-calendar-day-name">Sat</div>
            `;

            // Previous month's trailing days
            for (let i = firstDay - 1; i >= 0; i--) {
                const date = daysInPrevMonth - i;
                html += `<div class="full-calendar-day other-month">
                    <div class="full-calendar-day-number">${date}</div>
                </div>`;
            }

            // Current month's days
            for (let date = 1; date <= daysInMonth; date++) {
                const isToday = date === today.getDate() &&
                    month === today.getMonth() &&
                    year === today.getFullYear();

                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                const dayTasks = tasksWithDueDates[dateStr] || [];
                const filteredEvents = getFilteredGoogleEvents();
                const dayGoogleEvents = filteredEvents.filter(e => e.date === dateStr);

                const classes = ['full-calendar-day'];
                if (isToday) classes.push('today');

                let eventsHtml = '';

                // Show tasks
                dayTasks.slice(0, 3).forEach(task => {
                    eventsHtml += `<div class="full-calendar-event task" title="${task.text}">${task.text}</div>`;
                });

                // Show Google Calendar events
                dayGoogleEvents.slice(0, 2).forEach(event => {
                    eventsHtml += `<div class="full-calendar-event google" title="${event.title}">${event.title}</div>`;
                });

                const totalEvents = dayTasks.length + dayGoogleEvents.length;
                if (totalEvents > 3) {
                    eventsHtml += `<div style="font-size: 10px; color: var(--text-muted);">+${totalEvents - 3} more</div>`;
                }

                html += `<div class="${classes.join(' ')}" onclick="selectFullCalendarDate(${year}, ${month}, ${date})">
                    <div class="full-calendar-day-number">${date}</div>
                    <div class="full-calendar-events">${eventsHtml}</div>
                </div>`;
            }

            // Next month's leading days
            const totalCells = firstDay + daysInMonth;
            const remainingCells = (7 - (totalCells % 7)) % 7;
            for (let date = 1; date <= remainingCells; date++) {
                html += `<div class="full-calendar-day other-month">
                    <div class="full-calendar-day-number">${date}</div>
                </div>`;
            }

            grid.innerHTML = html;
        }

        function selectFullCalendarDate(year, month, date) {
            // Sync with the small calendar
            currentCalendarDate = new Date(year, month, 1);
            selectedDate = new Date(year, month, date);
            renderCalendar();
            // Could also open a day detail view in the future
        }

        function getTasksForMonth(year, month) {
            const tasks = {};

            // Try to get tasks from the global taskData (defined in app.js)
            if (typeof window.taskData !== 'undefined') {
                // Collect all tasks from all sections
                ['today', 'longterm'].forEach(section => {
                    if (window.taskData[section]) {
                        Object.values(window.taskData[section]).forEach(group => {
                            if (group.tasks) {
                                group.tasks.forEach(task => {
                                    if (task.dueDate) {
                                        const dueDate = new Date(task.dueDate);
                                        if (dueDate.getFullYear() === year && dueDate.getMonth() === month) {
                                            const dateStr = task.dueDate;
                                            if (!tasks[dateStr]) tasks[dateStr] = [];
                                            tasks[dateStr].push(task);
                                        }
                                    }
                                });
                            }
                        });
                    }
                });
            }

            return tasks;
        }

        // ===== GOOGLE CALENDAR INTEGRATION =====
        const GOOGLE_API_KEY = 'AIzaSyCwMnIWcaAVabpI_wE00hB1VvjFjpXTUsk';
        const GOOGLE_CLIENT_ID = '708407777052-539vipe049n1fjujkrgdh4ks0h3ll3s2.apps.googleusercontent.com';
        const GOOGLE_SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';

        let googleTokenClient = null;
        let googleAccessToken = null;
        let isGoogleCalendarConnected = false;

        // Initialize Google API when the page loads
        function initializeGoogleAPI() {
            // Load the Google API client
            if (typeof gapi !== 'undefined') {
                gapi.load('client', async () => {
                    try {
                        await gapi.client.init({
                            apiKey: GOOGLE_API_KEY,
                        });

                        // Explicitly load the Calendar API
                        await gapi.client.load('calendar', 'v3');
                        console.log('Google API client initialized with Calendar API');

                        // Check if we have a stored token
                        const storedToken = localStorage.getItem('googleCalendarToken');
                        if (storedToken) {
                            googleAccessToken = storedToken;
                            gapi.client.setToken({ access_token: storedToken });
                            // Verify token is still valid by fetching events
                            try {
                                await fetchGoogleCalendarEvents();
                                isGoogleCalendarConnected = true;
                                updateGoogleCalendarStatus(true);
                            } catch (e) {
                                // Token expired, clear it
                                localStorage.removeItem('googleCalendarToken');
                                googleAccessToken = null;
                            }
                        }
                    } catch (error) {
                        console.error('Error initializing Google API:', error);
                    }
                });
            }

            // Initialize the token client for OAuth
            if (typeof google !== 'undefined' && google.accounts) {
                googleTokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: GOOGLE_SCOPES,
                    callback: handleGoogleAuthResponse,
                });
            }
        }

        // Wait for scripts to load then initialize
        window.addEventListener('load', () => {
            // Give the scripts a moment to fully load
            setTimeout(initializeGoogleAPI, 500);
        });

        function connectGoogleCalendar() {
            if (!googleTokenClient) {
                // Try to initialize again
                if (typeof google !== 'undefined' && google.accounts) {
                    googleTokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: GOOGLE_CLIENT_ID,
                        scope: GOOGLE_SCOPES,
                        callback: handleGoogleAuthResponse,
                    });
                } else {
                    alert('Google API is still loading. Please try again in a moment.');
                    return;
                }
            }

            // Request access token
            googleTokenClient.requestAccessToken();
        }

        function handleGoogleAuthResponse(response) {
            if (response.error) {
                console.error('Google Auth Error:', response);
                alert('Failed to connect to Google Calendar. Please try again.');
                return;
            }

            googleAccessToken = response.access_token;
            localStorage.setItem('googleCalendarToken', googleAccessToken);
            gapi.client.setToken({ access_token: googleAccessToken });

            isGoogleCalendarConnected = true;
            updateGoogleCalendarStatus(true);

            // Fetch calendar events
            fetchGoogleCalendarEvents();
        }

        async function fetchGoogleCalendarEvents() {
            if (!googleAccessToken) {
                console.log('No access token available');
                return;
            }

            try {
                // Ensure Calendar API is loaded
                if (!gapi.client.calendar) {
                    console.log('Loading Calendar API...');
                    await gapi.client.load('calendar', 'v3');
                    console.log('Calendar API loaded');
                }

                // Get events for the next 3 months and past 1 month
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                const threeMonthsLater = new Date();
                threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);

                const response = await gapi.client.calendar.events.list({
                    calendarId: 'primary',
                    timeMin: oneMonthAgo.toISOString(),
                    timeMax: threeMonthsLater.toISOString(),
                    showDeleted: false,
                    singleEvents: true,
                    maxResults: 250,
                    orderBy: 'startTime',
                });

                const events = response.result.items || [];

                // Convert to our format
                googleCalendarEvents = events.map(event => {
                    const start = event.start.dateTime || event.start.date;
                    const dateStr = start.split('T')[0]; // Get just the date part

                    return {
                        id: event.id,
                        title: event.summary || '(No title)',
                        date: dateStr,
                        startTime: event.start.dateTime ? new Date(event.start.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'All day',
                        endTime: event.end.dateTime ? new Date(event.end.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : null,
                        location: event.location || null,
                        description: event.description || null,
                        calendarId: 'primary',
                        isGoogleEvent: true
                    };
                });

                console.log(`Fetched ${googleCalendarEvents.length} Google Calendar events`);

                // Also try to fetch from other calendars the user has access to
                await fetchOtherCalendars();

                // Fetch calendar list for the picker
                await fetchCalendarList();

                // Re-render calendars to show the events
                renderCalendar();
                if (document.getElementById('calendarFrameView').classList.contains('active')) {
                    renderCalendarFrame();
                }

            } catch (error) {
                console.error('Error fetching Google Calendar events:', error);
                if (error.status === 401) {
                    // Token expired
                    disconnectGoogleCalendar();
                    alert('Google Calendar session expired. Please reconnect.');
                }
                throw error;
            }
        }

        async function fetchOtherCalendars() {
            try {
                const response = await gapi.client.calendar.calendarList.list();
                const calendars = response.result.items || [];

                // Find the primary calendar's actual ID and update our primary events
                const primaryCalendar = calendars.find(c => c.primary === true);
                if (primaryCalendar) {
                    // Update primary calendar events with the actual calendar ID
                    googleCalendarEvents = googleCalendarEvents.map(event => {
                        if (event.calendarId === 'primary') {
                            return { ...event, calendarId: primaryCalendar.id, calendarName: primaryCalendar.summary, calendarColor: primaryCalendar.backgroundColor };
                        }
                        return event;
                    });
                }

                // Fetch events from each calendar
                for (const calendar of calendars) {
                    if (calendar.primary) continue; // Already fetched

                    try {
                        const oneMonthAgo = new Date();
                        oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                        const threeMonthsLater = new Date();
                        threeMonthsLater.setMonth(threeMonthsLater.getMonth() + 3);

                        const eventsResponse = await gapi.client.calendar.events.list({
                            calendarId: calendar.id,
                            timeMin: oneMonthAgo.toISOString(),
                            timeMax: threeMonthsLater.toISOString(),
                            showDeleted: false,
                            singleEvents: true,
                            maxResults: 100,
                            orderBy: 'startTime',
                        });

                        const events = eventsResponse.result.items || [];

                        const mappedEvents = events.map(event => {
                            const start = event.start.dateTime || event.start.date;
                            const dateStr = start.split('T')[0];

                            return {
                                id: event.id,
                                title: event.summary || '(No title)',
                                date: dateStr,
                                startTime: event.start.dateTime ? new Date(event.start.dateTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'All day',
                                calendarId: calendar.id,
                                calendarName: calendar.summary,
                                calendarColor: calendar.backgroundColor,
                                isGoogleEvent: true
                            };
                        });

                        googleCalendarEvents = [...googleCalendarEvents, ...mappedEvents];
                    } catch (e) {
                        console.log(`Could not fetch events from calendar: ${calendar.summary}`);
                    }
                }

                console.log(`Total Google Calendar events: ${googleCalendarEvents.length}`);
            } catch (error) {
                console.log('Could not fetch calendar list:', error);
            }
        }

        function disconnectGoogleCalendar() {
            const token = googleAccessToken;
            googleAccessToken = null;
            isGoogleCalendarConnected = false;
            googleCalendarEvents = [];
            localStorage.removeItem('googleCalendarToken');

            if (token && typeof google !== 'undefined' && google.accounts) {
                google.accounts.oauth2.revoke(token, () => {
                    console.log('Google token revoked');
                });
            }

            updateGoogleCalendarStatus(false);
            renderCalendar();
            if (document.getElementById('calendarFrameView').classList.contains('active')) {
                renderCalendarFrame();
            }
        }

        // Refresh events periodically (every 5 minutes)
        setInterval(() => {
            if (isGoogleCalendarConnected) {
                fetchGoogleCalendarEvents();
            }
        }, 5 * 60 * 1000);

        function updateGoogleCalendarStatus(connected) {
            // Update all status elements
            const statusElements = [
                document.getElementById('googleCalendarStatus'),
                document.getElementById('calendarFrameGoogleStatus')
            ];

            const connectButtons = document.querySelectorAll('.google-connect-btn');

            statusElements.forEach(el => {
                if (el) {
                    if (connected) {
                        el.textContent = ' Connected to Google Calendar';
                        el.classList.add('connected');
                    } else {
                        el.textContent = 'Google Calendar not connected';
                        el.classList.remove('connected');
                    }
                }
            });

            // Update connect buttons
            connectButtons.forEach(btn => {
                if (connected) {
                    btn.innerHTML = `
                        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Disconnect
                    `;
                    btn.onclick = disconnectGoogleCalendar;
                } else {
                    btn.innerHTML = `
                        <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        Connect Google Calendar
                    `;
                    btn.onclick = connectGoogleCalendar;
                }
            });
        }

        // Make Google Calendar functions globally available
        window.connectGoogleCalendar = connectGoogleCalendar;
        window.disconnectGoogleCalendar = disconnectGoogleCalendar;
        window.fetchGoogleCalendarEvents = fetchGoogleCalendarEvents;

        // Debug function - type checkGoogleCalendar() in console
        window.checkGoogleCalendar = function() {
            console.log('Connected:', isGoogleCalendarConnected);
            console.log('Events count:', googleCalendarEvents.length);
            console.log('Sample events:', googleCalendarEvents.slice(0, 5));
            if (googleCalendarEvents.length > 0) {
                console.log('Date format example:', googleCalendarEvents[0].date);
            }
            return googleCalendarEvents;
        };

        // ===== CALENDAR PICKER =====
        let availableCalendars = []; // List of all calendars from Google
        let selectedCalendarIds = JSON.parse(localStorage.getItem('selectedCalendarIds') || '[]');

        async function fetchCalendarList() {
            if (!googleAccessToken || !gapi.client.calendar) {
                return;
            }

            try {
                const response = await gapi.client.calendar.calendarList.list();
                availableCalendars = response.result.items || [];
                console.log('Available calendars:', availableCalendars.map(c => c.summary));

                // If no calendars are selected yet, select all by default
                if (selectedCalendarIds.length === 0) {
                    selectedCalendarIds = availableCalendars.map(c => c.id);
                    saveSelectedCalendars();
                }

                renderCalendarPicker();
                showCalendarPicker();
            } catch (error) {
                console.error('Error fetching calendar list:', error);
            }
        }

        function renderCalendarPicker() {
            const list = document.getElementById('calendarPickerList');
            if (!list || availableCalendars.length === 0) return;

            list.innerHTML = availableCalendars.map(calendar => {
                const isSelected = selectedCalendarIds.includes(calendar.id);
                const color = calendar.backgroundColor || '#4285F4';

                return `
                    <div class="calendar-picker-item ${isSelected ? 'selected' : ''}"
                         onclick="toggleCalendarSelection('${calendar.id}')">
                        <div class="calendar-picker-checkbox">${isSelected ? '' : ''}</div>
                        <div class="calendar-picker-color" style="background: ${color}"></div>
                        <span class="calendar-picker-name">${calendar.summary}</span>
                    </div>
                `;
            }).join('');
        }

        function toggleCalendarSelection(calendarId) {
            const index = selectedCalendarIds.indexOf(calendarId);
            if (index > -1) {
                selectedCalendarIds.splice(index, 1);
            } else {
                selectedCalendarIds.push(calendarId);
            }

            saveSelectedCalendars();
            renderCalendarPicker();
            // Re-render calendars with new filter (no need to re-fetch events)
            renderCalendar();
            if (document.getElementById('calendarFrameView').classList.contains('active')) {
                renderCalendarFrame();
            }
        }

        function toggleAllCalendars() {
            if (selectedCalendarIds.length === availableCalendars.length) {
                // All selected, so deselect all
                selectedCalendarIds = [];
            } else {
                // Select all
                selectedCalendarIds = availableCalendars.map(c => c.id);
            }

            saveSelectedCalendars();
            renderCalendarPicker();
            // Re-render calendars with new filter (no need to re-fetch events)
            renderCalendar();
            if (document.getElementById('calendarFrameView').classList.contains('active')) {
                renderCalendarFrame();
            }
        }

        function saveSelectedCalendars() {
            localStorage.setItem('selectedCalendarIds', JSON.stringify(selectedCalendarIds));
        }

        function showCalendarPicker() {
            const section = document.getElementById('calendarPickerSection');
            if (section && isGoogleCalendarConnected) {
                section.style.display = 'block';
            }
        }

        function hideCalendarPicker() {
            const section = document.getElementById('calendarPickerSection');
            if (section) {
                section.style.display = 'none';
            }
        }

        // Filter events based on selected calendars
        function getFilteredGoogleEvents() {
            return googleCalendarEvents.filter(event => {
                // Events have calendarId property
                return selectedCalendarIds.includes(event.calendarId);
            });
        }

        // Make calendar picker functions globally available
        window.toggleCalendarSelection = toggleCalendarSelection;
        window.toggleAllCalendars = toggleAllCalendars;
        window.fetchCalendarList = fetchCalendarList;

        // Make functions globally available
        window.openFullCalendar = openFullCalendar;
        window.closeFullCalendar = closeFullCalendar;
        window.fullCalendarPrevMonth = fullCalendarPrevMonth;
        window.fullCalendarNextMonth = fullCalendarNextMonth;

        // ===== LET'S GET TO WORK SESSION =====
        let workSessionTasks = [];
        let workSessionStartTime = null;
        let workSessionTimerInterval = null;

        const motivationalQuotes = [
            "The secret of getting ahead is getting started.",
            "Done is better than perfect.",
            "You've got this!",
            "Small progress is still progress.",
            "Focus on progress, not perfection.",
            "One task at a time.",
            "You're closer than you were yesterday.",
            "Action cures fear.",
            "Start where you are. Use what you have. Do what you can.",
            "The only way to do great work is to love what you do."
        ];

        function openWorkSession() {
            const overlay = document.getElementById('workSessionOverlay');
            overlay.classList.add('active');

            // Start timer if not already running
            if (!workSessionStartTime) {
                workSessionStartTime = new Date();
                startWorkTimer();
            }

            renderWorkTasks();
            updateWorkProgress();
            setRandomMotivation();
        }

        function exitWorkSession() {
            if (workSessionTasks.some(t => !t.completed)) {
                if (!confirm('You have incomplete tasks. Are you sure you want to exit?')) {
                    return;
                }
            }

            const overlay = document.getElementById('workSessionOverlay');
            overlay.classList.remove('active');

            // Don't clear - keep session data for resuming
        }

        function clearWorkSession() {
            if (workSessionTasks.length > 0 && !confirm('Clear all tasks from this session?')) {
                return;
            }

            workSessionTasks = [];
            workSessionStartTime = null;
            if (workSessionTimerInterval) {
                clearInterval(workSessionTimerInterval);
                workSessionTimerInterval = null;
            }
            document.getElementById('workSessionTimer').textContent = '00:00:00';
            renderWorkTasks();
            updateWorkProgress();
        }

        function completeWorkSession() {
            const elapsed = getElapsedTime();
            const completedCount = workSessionTasks.filter(t => t.completed).length;

            alert(`Great job! You completed ${completedCount} tasks in ${elapsed}!`);

            // Clear session
            workSessionTasks = [];
            workSessionStartTime = null;
            if (workSessionTimerInterval) {
                clearInterval(workSessionTimerInterval);
                workSessionTimerInterval = null;
            }

            const overlay = document.getElementById('workSessionOverlay');
            overlay.classList.remove('active');
            document.getElementById('workSessionTimer').textContent = '00:00:00';
        }

        function startWorkTimer() {
            if (workSessionTimerInterval) return;

            workSessionTimerInterval = setInterval(() => {
                document.getElementById('workSessionTimer').textContent = getElapsedTime();
            }, 1000);
        }

        function getElapsedTime() {
            if (!workSessionStartTime) return '00:00:00';

            const elapsed = Math.floor((new Date() - workSessionStartTime) / 1000);
            const hours = Math.floor(elapsed / 3600);
            const minutes = Math.floor((elapsed % 3600) / 60);
            const seconds = elapsed % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function addWorkTask() {
            const titleInput = document.getElementById('workTaskTitle');
            const linksInput = document.getElementById('workTaskLinks');
            const phoneInput = document.getElementById('workTaskPhone');
            const notesInput = document.getElementById('workTaskNotes');

            const title = titleInput.value.trim();
            if (!title) {
                alert('Please enter a task name');
                titleInput.focus();
                return;
            }

            const links = linksInput.value.trim()
                ? linksInput.value.split(',').map(l => l.trim()).filter(l => l)
                : [];

            const task = {
                id: Date.now(),
                title: title,
                links: links,
                phone: phoneInput.value.trim(),
                notes: notesInput.value.trim(),
                completed: false
            };

            workSessionTasks.push(task);

            // Clear inputs
            titleInput.value = '';
            linksInput.value = '';
            phoneInput.value = '';
            notesInput.value = '';

            // Start timer if this is the first task
            if (workSessionTasks.length === 1 && !workSessionStartTime) {
                workSessionStartTime = new Date();
                startWorkTimer();
            }

            renderWorkTasks();
            updateWorkProgress();
            titleInput.focus();
        }

        function toggleWorkTask(taskId) {
            const task = workSessionTasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                renderWorkTasks();
                updateWorkProgress();
            }
        }

        function removeWorkTask(taskId) {
            workSessionTasks = workSessionTasks.filter(t => t.id !== taskId);
            renderWorkTasks();
            updateWorkProgress();
        }

        function renderWorkTasks() {
            const container = document.getElementById('workSessionTasks');

            if (workSessionTasks.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                        <div style="font-size: 48px; margin-bottom: 16px;"></div>
                        <div style="font-size: 16px;">Add some tasks to get started!</div>
                    </div>
                `;
                return;
            }

            // Find first incomplete task to mark as current
            const firstIncompleteIndex = workSessionTasks.findIndex(t => !t.completed);

            container.innerHTML = workSessionTasks.map((task, index) => {
                const isCurrent = index === firstIncompleteIndex;
                const classes = ['work-task-card'];
                if (task.completed) classes.push('completed');
                if (isCurrent) classes.push('current');

                let linksHtml = '';
                if (task.links && task.links.length > 0) {
                    linksHtml = `<div class="work-task-links">
                        ${task.links.map(link => {
                            const url = link.startsWith('http') ? link : 'https://' + link;
                            const displayName = link.replace(/^https?:\/\//, '').split('/')[0];
                            return `<a href="${url}" target="_blank" class="work-task-link"> ${displayName}</a>`;
                        }).join('')}
                    </div>`;
                }

                let phoneHtml = '';
                if (task.phone) {
                    const cleanPhone = task.phone.replace(/\D/g, '');
                    phoneHtml = `<div class="work-task-phone"> <a href="tel:${cleanPhone}">${task.phone}</a></div>`;
                }

                let notesHtml = '';
                if (task.notes) {
                    notesHtml = `<div class="work-task-notes">${task.notes}</div>`;
                }

                return `
                    <div class="${classes.join(' ')}" data-task-id="${task.id}">
                        <div class="work-task-header">
                            <button class="work-task-checkbox" onclick="toggleWorkTask(${task.id})">
                                ${task.completed ? '' : ''}
                            </button>
                            <div class="work-task-title">${task.title}</div>
                            <button onclick="removeWorkTask(${task.id})" style="background: none; border: none; color: rgba(255,255,255,0.4); cursor: pointer; font-size: 18px; padding: 4px 8px;" title="Remove task"></button>
                        </div>
                        ${(linksHtml || phoneHtml || notesHtml) ? `
                            <div class="work-task-details">
                                ${linksHtml}
                                ${phoneHtml}
                                ${notesHtml}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateWorkProgress() {
            const total = workSessionTasks.length;
            const completed = workSessionTasks.filter(t => t.completed).length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;

            document.getElementById('workProgressText').textContent = `${completed} of ${total} tasks completed`;
            document.getElementById('workProgressFill').style.width = `${percentage}%`;

            // Show/hide complete button
            const completeBtn = document.getElementById('workCompleteBtn');
            if (total > 0 && completed === total) {
                completeBtn.style.display = 'block';
            } else {
                completeBtn.style.display = 'none';
            }
        }

        function setRandomMotivation() {
            const quote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            document.getElementById('workMotivationText').textContent = `"${quote}"`;
        }

        // Allow pressing Enter to add task
        document.getElementById('workTaskTitle')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addWorkTask();
            }
        });

        // Make functions globally available
        window.openWorkSession = openWorkSession;
        window.exitWorkSession = exitWorkSession;
        window.clearWorkSession = clearWorkSession;
        window.completeWorkSession = completeWorkSession;
        window.addWorkTask = addWorkTask;
        window.toggleWorkTask = toggleWorkTask;
        window.removeWorkTask = removeWorkTask;
    </script>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, collection, addDoc, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD-gfaA6kvJiAeN9mJ3lLKkN6DT4YQfMho",
            authDomain: "quick-task-dashboard.firebaseapp.com",
            projectId: "quick-task-dashboard",
            storageBucket: "quick-task-dashboard.firebasestorage.app",
            messagingSenderId: "774476454126",
            appId: "1:774476454126:web:1b3f0adb518d1418517bff",
            measurementId: "G-ZZ3B4H4TX1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Make db and Firestore functions available globally
        window.firebaseDB = db;

        // Firestore helper functions
        window.firestore = {
            // Save task data to Firestore
            async saveTaskData(taskData, archivedTasks, settings) {
                try {
                    const docRef = doc(db, 'users', 'default');
                    await setDoc(docRef, {
                        taskData: taskData,
                        archivedTasks: archivedTasks,
                        settings: settings,
                        lastUpdated: new Date().toISOString()
                    }, { merge: true });
                    console.log('Data synced to Firestore');
                    return { success: true };
                } catch (error) {
                    console.error('Firestore save error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Load task data from Firestore
            async loadTaskData() {
                try {
                    const docRef = doc(db, 'users', 'default');
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        console.log('Data loaded from Firestore');
                        return { success: true, data: docSnap.data() };
                    } else {
                        console.log('No Firestore data found');
                        return { success: true, data: null };
                    }
                } catch (error) {
                    console.error('Firestore load error:', error);
                    // Re-throw the error so it can be handled properly (including permission errors)
                    throw error;
                }
            },

            // Log time tracking data for long-term analytics
            async logTimeEntry(taskTitle, projectName, estimatedMinutes, actualMinutes) {
                try {
                    const timeLogsRef = collection(db, 'users', 'default', 'timeLogs');
                    await addDoc(timeLogsRef, {
                        taskTitle: taskTitle,
                        projectName: projectName || 'Uncategorized',
                        estimatedMinutes: estimatedMinutes || null,
                        actualMinutes: actualMinutes,
                        completedAt: new Date().toISOString(),
                        accuracy: estimatedMinutes ? Math.round((actualMinutes / estimatedMinutes) * 100) : null
                    });
                    console.log('Time entry logged to Firestore');
                    return { success: true };
                } catch (error) {
                    console.error('Time log error:', error);
                    return { success: false, error: error.message };
                }
            },

            // Get recent time logs for analytics
            async getTimeLogs(limitCount = 100) {
                try {
                    const timeLogsRef = collection(db, 'users', 'default', 'timeLogs');
                    const q = query(timeLogsRef, orderBy('completedAt', 'desc'), limit(limitCount));
                    const querySnapshot = await getDocs(q);
                    const logs = [];
                    querySnapshot.forEach((doc) => {
                        logs.push({ id: doc.id, ...doc.data() });
                    });
                    return { success: true, data: logs };
                } catch (error) {
                    console.error('Time logs fetch error:', error);
                    return { success: false, error: error.message };
                }
            }
        };

        // Signal that Firebase is ready
        window.firebaseReady = true;
        window.dispatchEvent(new Event('firebaseReady'));
    </script>

    <!-- Focus Mode Setup Modal -->
    <div id="focusSetupModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 500px;">
            <div class="custom-modal-header">
                <h3> Focus Mode Setup</h3>
                <button class="modal-close-btn" onclick="closeFocusSetupModal()" title="Close focus setup modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 16px; font-weight: 600; color: #333; margin-bottom: 8px;">Task:</div>
                    <div style="padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; color: #333; font-size: 15px;" id="focusSetupTaskTitle"></div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Alert Interval (minutes)</label>
                    <input type="number" id="focusAlertIntervalInput"
                           min="1" max="15" step="1" value="10"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; font-family: inherit; text-align: center; font-weight: 600;"
                           placeholder="1-15">
                    <div style="display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap;">
                        <button onclick="setFocusInterval(1)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">1</button>
                        <button onclick="setFocusInterval(2)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">2</button>
                        <button onclick="setFocusInterval(3)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">3</button>
                        <button onclick="setFocusInterval(4)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">4</button>
                        <button onclick="setFocusInterval(6)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">6</button>
                        <button onclick="setFocusInterval(7)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">7</button>
                        <button onclick="setFocusInterval(8)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">8</button>
                        <button onclick="setFocusInterval(9)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">9</button>
                        <button onclick="setFocusInterval(11)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">11</button>
                        <button onclick="setFocusInterval(12)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">12</button>
                        <button onclick="setFocusInterval(13)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">13</button>
                        <button onclick="setFocusInterval(14)" onmouseover="this.style.background='rgba(102, 126, 234, 0.2)'" onmouseout="if(!this.classList.contains('selected')) this.style.background='rgba(102, 126, 234, 0.1)'" style="flex: 0 0 calc(20% - 5px); padding: 8px 4px; background: rgba(102, 126, 234, 0.1); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.2s; font-size: 13px;">14</button>
                    </div>
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;"> Link Website (Optional)</label>
                    <input type="url" id="focusWebsiteUrlInput" 
                           list="focusUrlSuggestions"
                           autocomplete="url"
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;"
                           placeholder="https://example.com">
                    <datalist id="focusUrlSuggestions"></datalist>
                    <div style="font-size: 12px; color: #666; margin-top: 6px;">We'll remember your frequently used URLs</div>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeFocusSetupModal()">Cancel</button>
                <button class="modal-btn modal-btn-submit" onclick="submitFocusSetup()">Start Focusing</button>
            </div>
        </div>
    </div>

    <!-- Task Completion Follow-up Modal -->
    <div id="taskFollowUpModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 500px;">
            <div class="custom-modal-header">
                <h3> Task Completed!</h3>
                <button class="modal-close-btn" onclick="closeTaskFollowUpModal()" title="Close task follow-up modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div style="margin-bottom: 16px; padding: 12px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border-left: 4px solid #22c55e;">
                    <div style="font-weight: 600; color: #333;" id="completedTaskTitle"></div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">
                         Any notes about this task? (optional)
                    </label>
                    <textarea id="followUpNotes"
                              placeholder="What did you learn? Any important details to remember?"
                              style="width: 100%; min-height: 60px; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">
                         Follow-up task needed? (optional)
                    </label>
                    <input type="text" id="followUpTaskTitle"
                           placeholder="e.g., Send follow-up email, Review results..."
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; font-family: inherit;">
                </div>

                <div id="followUpTaskOptions" style="display: none; margin-left: 16px; padding: 12px; background: #f8f9fa; border-radius: 8px;">
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; font-weight: 500; margin-bottom: 6px; color: #555; font-size: 13px;">Add to:</label>
                        <div style="display: flex; gap: 12px;">
                            <label style="cursor: pointer; font-size: 14px;">
                                <input type="radio" name="followUpSection" value="today" checked style="margin-right: 6px;">
                                 Today
                            </label>
                            <label style="cursor: pointer; font-size: 14px;">
                                <input type="radio" name="followUpSection" value="longterm" style="margin-right: 6px;">
                                 Long-term
                            </label>
                        </div>
                    </div>
                    <div>
                        <label style="display: block; font-weight: 500; margin-bottom: 6px; color: #555; font-size: 13px;">Due date (optional):</label>
                        <input type="text" id="followUpDueDate" placeholder="tomorrow, next week..."
                               style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px;">
                    </div>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeTaskFollowUpModal()">Skip</button>
                <button class="modal-btn modal-btn-submit" onclick="submitTaskFollowUp()">Save</button>
            </div>
        </div>
    </div>

    <!-- Refine Inbox Modal -->
    <div id="refineInboxModal" class="custom-modal">
        <div class="custom-modal-content refine-modal-content">
            <div class="custom-modal-header">
                <h3> Refine Inbox Tasks</h3>
                <button class="modal-close-btn" onclick="closeRefineInboxModal()" title="Close refine inbox modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <div class="refine-mode-toggle">
                    <button class="refine-mode-btn active" id="refineModeOne" onclick="setRefineMode('one')">One at a Time</button>
                    <button class="refine-mode-btn" id="refineModeBatch" onclick="setRefineMode('batch')">Batch View</button>
                </div>
                
                <!-- One at a Time View -->
                <div id="refineOneView" class="refine-view">
                    <div class="refine-task-card">
                        <div class="refine-task-header">
                            <h4 class="refine-task-title" id="refineCurrentTaskTitle"></h4>
                        </div>
                        <div class="refine-quick-actions" id="refineQuickActions">
                            <!-- Quick action buttons will be inserted here -->
                        </div>
                        <div class="refine-input-group">
                            <label class="refine-input-label">Due Date (optional)</label>
                            <input type="text" class="refine-input" id="refineDueDate" placeholder="tomorrow, next Friday, 2024-12-25...">
                        </div>
                        <div class="refine-input-group">
                            <label class="refine-input-label">External Deadline (date-limited by external factors)</label>
                            <input type="date" class="refine-input" id="refineExternalDeadline">
                        </div>
                        <div class="refine-input-group">
                            <label class="refine-input-label">Tags (optional, comma-separated)</label>
                            <input type="text" class="refine-input" id="refineTags" placeholder="urgent, work, personal...">
                        </div>
                        <div class="refine-input-group">
                            <label class="refine-input-label">Notes (optional)</label>
                            <textarea class="refine-input" id="refineNotes" rows="3" placeholder="Additional context or details..."></textarea>
                        </div>
                        <div class="refine-navigation">
                            <div class="refine-task-counter" id="refineTaskCounter">Task 1 of 5</div>
                            <div class="refine-nav-buttons">
                                <button class="refine-nav-btn" id="refinePrevBtn" onclick="refinePreviousTask()" disabled> Previous</button>
                                <button class="refine-nav-btn" onclick="refineSkipTask()">Skip</button>
                                <button class="refine-nav-btn" onclick="refineApplyToCurrent()">Apply</button>
                                <button class="refine-nav-btn" id="refineNextBtn" onclick="refineNextTask()">Next </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Batch View -->
                <div id="refineBatchView" class="refine-view" style="display: none;">
                    <div class="refine-task-list" id="refineBatchTaskList">
                        <!-- Task list will be populated here -->
                    </div>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeRefineInboxModal()">Close</button>
                <button class="modal-btn modal-btn-submit" onclick="refineSaveAll()">Save All Changes</button>
            </div>
        </div>
    </div>

    <!-- Choice Modal (for selecting between options) -->
    <div id="choiceModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 400px;">
            <div class="custom-modal-header">
                <h3 id="choiceModalTitle">Choose an Option</h3>
                <button class="modal-close-btn" onclick="closeChoiceModal()" title="Close choice modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <p id="choiceModalMessage"></p>
                <div id="choiceModalButtons" class="choice-buttons">
                    <!-- Buttons will be inserted dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Modal (for yes/no questions) -->
    <div id="confirmModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 400px;">
            <div class="custom-modal-header">
                <h3 id="confirmModalTitle">Confirm</h3>
                <button class="modal-close-btn" onclick="closeConfirmModal(false)" title="Close confirmation modal">&times;</button>
            </div>
            <div class="custom-modal-body">
                <p id="confirmModalMessage"></p>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-cancel" onclick="closeConfirmModal(false)">No</button>
                <button class="modal-btn modal-btn-submit" onclick="closeConfirmModal(true)">Yes</button>
            </div>
        </div>
    </div>

    <!-- Daily Digest Modal -->
    <div id="dailyDigestModal" class="custom-modal">
        <div class="custom-modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="custom-modal-header">
                <h3> Daily Digest</h3>
                <button class="modal-close-btn" onclick="closeDailyDigest()" title="Close daily digest">&times;</button>
            </div>
            <div class="custom-modal-body" id="dailyDigestContent">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-submit" onclick="closeDailyDigest()">Got it!</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
